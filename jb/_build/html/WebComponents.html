
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Web Components &#8212; Libro DWEC</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=dd2cc81e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'WebComponents';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Supabase: (Backend como Servicio)" href="supabase.html" />
    <link rel="prev" title="Web Workers" href="webworkers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Libro DWEC - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Libro DWEC - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Desarrollo Web en Entorno Cliente (DWEC)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introducción</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="desarrollofrontend.html">La Web y el Desarrollo Web</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Javascript</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="jsenhtml.html">Javascript en el navegador</a></li>
<li class="toctree-l1"><a class="reference internal" href="lenguajejavascript.html">El lenguaje Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="arraysobjetosclases.html">Arrays Objetos y clases</a></li>
<li class="toctree-l1"><a class="reference internal" href="dom.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="iteradores.html">Iteradores</a></li>
<li class="toctree-l1"><a class="reference internal" href="modulos.html">Módulos</a></li>
<li class="toctree-l1"><a class="reference internal" href="promesas.html">Asincronía y Promesas</a></li>
<li class="toctree-l1"><a class="reference internal" href="ajax.html">Comunicación con el servidor</a></li>
<li class="toctree-l1"><a class="reference internal" href="programacionfuncionalreactiva.html">Programación Funcional, Asíncrona y Reactiva en JavaScript</a></li>



<li class="toctree-l1"><a class="reference internal" href="errores.html">Gestión de Errores</a></li>
<li class="toctree-l1"><a class="reference internal" href="webworkers.html">Web Workers</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Web Components</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Desarrollo de proyectos fronted</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="supabase.html">Supabase: (Backend como Servicio)</a></li>
<li class="toctree-l1"><a class="reference internal" href="npm.html">NPM</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="vite.html">Vite</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-cd.html">Integración y Despliegue Continuo (CI/CD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="proyectos.html">Proyectos en Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentacion.html">Documentación en JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="proyectovanilla.html">Proyecto completo en Javascript</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Angular</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="typescript.html">Typescript</a></li>
<li class="toctree-l1"><a class="reference internal" href="angular.html">Introducción a Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="httpangular.html">Comunicación con el servidor en Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="rutasangular.html">Rutas en Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="formulariosangular.html">Formularios en Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="proyectoangular.html">Proyecto Angular</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/xxjcaxx/libro_dwec/tree/master" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/xxjcaxx/libro_dwec/tree/master/issues/new?title=Issue%20on%20page%20%2FWebComponents.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/WebComponents.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Web Components</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptos-iniciales">Conceptos iniciales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternativas">Alternativas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-elements">Custom Elements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-de-vida">Ciclo de vida</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#registrar-el-elemento-personalizado">Registrar el elemento personalizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usar-el-elemento-personalizado">Usar el elemento personalizado</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shadow-dom">Shadow DOM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estilos-en-shadow-dom">Estilos en shadow DOM</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#css-scopes-shadow-parts">CSS Scopes / Shadow Parts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#templates">Templates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternativa-con-template-literals">Alternativa con Template Literals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pasar-datos-al-componente">Pasar datos al componente</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructor-de-los-componentes">Constructor de los componentes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atributos">Atributos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data"><code class="docutils literal notranslate"><span class="pre">data-</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#propiedades">Propiedades</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos">Métodos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observables">Observables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slots">Slots</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pasar-elementos-del-dom-como-hijos-del-web-component">Pasar elementos del DOM como hijos del Web Component</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mediante-eventos">Mediante Eventos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mantener-el-estado-de-la-aplicacion-con-componentes">Mantener el estado de la aplicación con componentes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mantener-el-estado-con-inyeccion-de-dependencias">Mantener el estado con Inyección de dependencias</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion-a-la-inyeccion-de-dependencias">Introducción a la inyección de dependencias</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#di-en-web-components">DI en Web Components</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mantener-el-estado-con-un-context-provider">Mantener el estado con un Context Provider</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejemplo-completo">Ejemplo completo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">Conclusiones</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="web-components">
<h1>Web Components<a class="headerlink" href="#web-components" title="Link to this heading">#</a></h1>
<p>En el capítulo del DOM hemos introducido gran parte de los conocimientos necesarios para este capítulo. No obstante, necesitamos haber trabajado con todos los demás conceptos y haber practicado con proyectos simples para entender la importancia de los <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Components</span></code>.</p>
<p>Si queremos hacer una SPA que maneje datos obtenidos del servidor y los muestre de manera reactiva, podemos seguir estos pasos:</p>
<ul class="simple">
<li><p>El router manda descargar los datos del servidor y los pasa a una función que los aplica a una plantilla.</p></li>
<li><p>El router se suscribe a un Observable de los datos del servidor y cada vez que llegan nuevos datos los renderiza con una plantilla.</p></li>
<li><p>El router renderiza una plantilla con “placeholders”, espera los datos del servidor y rellena la plantilla con esos datos.</p></li>
<li><p>…</p></li>
</ul>
<p>En cualquiera de estas opciones, hay problemas para volver a renderizar cuando hay datos nuevos, para mantener a raya a las suscripciones, para gestionar el estado de la aplicación o para mantenerla suficientemente desacoplada. También es complicado reutilizar esas funciones en otros proyectos.</p>
<p>Los <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Components</span></code> son una definición de la W3C para estandarizar lo que comenzaba a ser un aspecto común de los frameworks e intentar hacer componentes reutilizables para todos. Estos componentes se pueden hacer a partir de las mejoras de ES6 y HTML5. Se trata de una tecnología base que no depende de ningúna librería o framework. Aunque las librerías y frameworks pueden hacer uso de ellos para ampliarlos o mejorar la facilidad de uso.</p>
<blockquote>
<div><p>En la definición que podemos encontrar en la web de MDN: <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components">https://developer.mozilla.org/en-US/docs/Web/API/Web_components</a>, no incorpora la reactividad, pero nosotros vamos a incorporarla para hacerlos más útiles en el curso.</p>
</div></blockquote>
<blockquote>
<div><p>Llegado el momento de hacer Web Components desde 0 con “vanilla Javascript” nos podemos preguntar si no será mejor usar un framework. Intentemos resistir esa tentación, al menos para aprender, porque esos conocimientos nos permitirán entender profundamente cómo funciona, por ejemplo, Angular o React. También hay frameworks especializados en crear Web Components como Lit: <a class="reference external" href="https://lit.dev/">https://lit.dev/</a></p>
</div></blockquote>
<section id="conceptos-iniciales">
<h2>Conceptos iniciales<a class="headerlink" href="#conceptos-iniciales" title="Link to this heading">#</a></h2>
<p>Antes de comenzar con los detalles, hay que destacar los tres pilares de los Web Components:</p>
<ul class="simple">
<li><p><strong>Custom Elements</strong></p></li>
<li><p><strong>Shadow DOM</strong></p></li>
<li><p><strong>Templates</strong></p></li>
</ul>
<p>Se pueden crear componentes de muchas maneras, pero la definición oficial parte de la posibilidad de crear <strong>Elementos personalizados</strong> o <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">Elements</span></code>. Esto se puede hacer porque Javascript permite heredar de <code class="docutils literal notranslate"><span class="pre">HTMLElement</span></code>: <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements">https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements</a>. Luego veremos las posibilidades que hay con esto.</p>
<p>Una de las necesidades cubiertas por los Web Components es la reutilización del código.  Los elementos personalizados pueden ser diferentes al resto de la aplicación y tener sus propios scripts y estilos. Estos pueden colisionar con una aplicación para la que no fueron creados desde el principio. Pero Javascript permite encapsular estos elementos en un DOM separado del principal. Esta técnica se llama <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code>.</p>
<p>Para crear elementos personalizados en el <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code>, se pueden hacer programáticamente o a través del HTML con etiquetas como <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> o <code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code>.</p>
<p>Por consiguiente, un <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Component</span></code> tiene una clase que hereda de <code class="docutils literal notranslate"><span class="pre">HTMLElement</span></code> registrada en el <code class="docutils literal notranslate"><span class="pre">CustomElementRegistry</span></code> para que pueda ser utilizada en cualquier parte. Este elemento tiene un <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code> (opcional) para que su código y estilos no molesten al resto y se suele usar <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> para las plantillas. A continuación se puede usar como cualquier etiqueta.</p>
<p>Veamos un ‘hola mundo’:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">HelloWorldComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;hello world!&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;x-hello-world&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">HelloWorldComponent</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">helloComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;x-hello-world&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">helloComponent</span><span class="p">);</span>
</pre></div>
</div>
<p>A parte de insertar el componente por javascript, también podemos incluirlo directamente en el HTML:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">x-hello-world</span><span class="p">&gt;&lt;/</span><span class="nt">x-hello-world</span><span class="p">&gt;</span>
</pre></div>
</div>
<section id="alternativas">
<h3>Alternativas<a class="headerlink" href="#alternativas" title="Link to this heading">#</a></h3>
<p>Como todo en Javascript, es opcional usar Web components, pero es que también es opcional usar todas las técnicas anteriores. Si no hacemos un <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">Element</span></code> no entra en la definición de lo que estamos tratando, pero se puede hacer una función que retorne un elemento con <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code> y código personalizado que atiende a los eventos, descarga los datos, se suscribe a Observables… El problema es que perdemos las ventajas del ciclo de vida de los <code class="docutils literal notranslate"><span class="pre">HTMLElements</span></code>.</p>
<p>Tampoco es necesario siempre hacer <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code> si el código o estilo no va a interferir nunca.</p>
<p>Por otro lado, el uso de <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> puede ser farragoso en algunos casos comparado con las <code class="docutils literal notranslate"><span class="pre">Template</span> <span class="pre">Literals</span></code>. En nuestro caso, haremos un uso combinado de los mismos para aprovechar las ventajas de ambas técnicas.</p>
</section>
</section>
<section id="custom-elements">
<h2>Custom Elements<a class="headerlink" href="#custom-elements" title="Link to this heading">#</a></h2>
<p>Se trata de elementos HTML que tienen un comportamiento definido por el desarrollador. Una vez registrados, quedan disponibles en el navegador en esa página web.</p>
<p>Ya existen algunos creados como <code class="docutils literal notranslate"><span class="pre">HTMLImageElement</span></code> o <code class="docutils literal notranslate"><span class="pre">HTMLParagrafElement</span></code> que tienen un comportamiento extendido respecto al estándar de los elementos comunes. Pero a nosotros nos interesa crear nuevos desde cero.</p>
<p>Para crearlo tan solo hay que extender la clase:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">PopupInfo</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Element functionality written in here</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En el constructor se inicializa el elemento con valores por defecto, registro de eventos, creación del <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">Root</span></code> y poco más. Dejaremos la creación de elementos hijos o añadir atributos a estos para después, en otras etapas del ciclo de vida.</p>
<section id="ciclo-de-vida">
<h3>Ciclo de vida<a class="headerlink" href="#ciclo-de-vida" title="Link to this heading">#</a></h3>
<p>Los elementos personalizados cuentan con una serie de funciones que pueden ser implementadas y que son invocadas a lo largo de su ciclo de vida. Estas son:</p>
<ul class="simple">
<li><p>connectedCallback(): Se llama cada vez que se agrega el elemento al documento. Se recomienda configurar el elemento en este punto, mejor que en el constructor.</p></li>
<li><p>disconnectedCallback(): Se llama cada vez que se elimina el elemento del documento.</p></li>
<li><p>adoptedCallback(): Se llama cada vez que se mueve el elemento a un nuevo documento.</p></li>
<li><p>attributeChangedCallback(): se llama cuando se cambian, agregan, eliminan o reemplazan atributos.</p></li>
</ul>
<p>Podemos probar este código en la consola del navegador:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">MyCustomElement</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">observedAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;size&quot;</span><span class="p">];</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">();</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Constructor&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Custom element added to page.&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">disconnectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Custom element removed from page.&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">adoptedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Custom element moved to new page.&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">attributeChangedCallback</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">oldValue</span><span class="p">,</span><span class="w"> </span><span class="nx">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Attribute </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb"> has changed from </span><span class="si">${</span><span class="nx">oldValue</span><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><span class="nx">newValue</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;my-custom-element&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">MyCustomElement</span><span class="p">);</span>
<span class="c1">// La prueba</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">customElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;my-custom-element&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Creado&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">customElement</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Añadido&#39;</span><span class="p">);</span>
<span class="nx">customElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;customClass&#39;</span><span class="p">,</span><span class="s1">&#39;customClass2&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Cambio del atributo class&#39;</span><span class="p">);</span>
<span class="nx">customElement</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Eliminado&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Además de esas funciones del ciclo de vida, se pueden añadir otras. Una típica puede ser la función <code class="docutils literal notranslate"><span class="pre">render()</span></code> que retorna el elemento redibujado. Esto es útil si queremos que el contenido pueda ser actualizado reactivamente.</p>
<blockquote>
<div><p><strong>Elementos HTML nativos</strong> (como <code class="docutils literal notranslate"><span class="pre">div</span></code>, <code class="docutils literal notranslate"><span class="pre">span</span></code>, etc.) no tienen métodos del ciclo de vida de los Web Components, por lo que asignar <code class="docutils literal notranslate"><span class="pre">connectedCallback</span></code> o otras manualmente no funcionará.</p>
</div></blockquote>
</section>
<section id="registrar-el-elemento-personalizado">
<h3>Registrar el elemento personalizado<a class="headerlink" href="#registrar-el-elemento-personalizado" title="Link to this heading">#</a></h3>
<p>Como se puede ver en el ejemplo anterior, lo hemos registrado con:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;my-custom-element&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">MyCustomElement</span><span class="p">);</span>
</pre></div>
</div>
<p>Es importante recalcar que el nombre es preciso que tenga <strong>un guión (-)</strong> en medio del nombre para que Javascript no los confunda.</p>
</section>
<section id="usar-el-elemento-personalizado">
<h3>Usar el elemento personalizado<a class="headerlink" href="#usar-el-elemento-personalizado" title="Link to this heading">#</a></h3>
<p>Se puede usar con <code class="docutils literal notranslate"><span class="pre">document.createElement()</span></code> y como cualquier etiqueta HTML:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">my-custom-element</span><span class="p">&gt;&lt;/</span><span class="nt">my-custom-element</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="shadow-dom">
<h2>Shadow DOM<a class="headerlink" href="#shadow-dom" title="Link to this heading">#</a></h2>
<p>Como ya hemos visto en la introducción, el objetivo del <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code> es encapsular el comportamiento del elemento personalizado.</p>
<p>A partir de la raíz de DOM principal de la página web cuelgan todos los nodos de forma jerárquica. El Shadow DOM permite registrar árboles ocultos a partir de un nodo del árbol principal. Estos árboles empiezan por el <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">Root</span></code>. Esta raíz está unida al árbol principal mediante un nodo que actúa de <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">Host</span></code>.</p>
<p>Se pueden crear de forma imperativa mediante Javascript:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#host&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">host</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;open&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">span</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">);</span>
<span class="nx">span</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;I&#39;m in the shadow DOM&quot;</span><span class="p">;</span>
<span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">span</span><span class="p">);</span>
</pre></div>
</div>
<p>También se puede crear de forma declarativa (desde el servidor) mediante HTML:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;host&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">template</span> <span class="na">shadowrootmode</span><span class="o">=</span><span class="s">&quot;open&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>I&#39;m in the shadow DOM<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>La segunda manera permite delegar la creación del <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code> al servidor, al enviar este el HTML ya sea dinámica o estáticamente.</p>
<p>Observemos que en los dos casos tenemos la palabra <code class="docutils literal notranslate"><span class="pre">open</span></code>, esta permite que el <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">DOM</span></code> sea accesible desde la web. Si está en <code class="docutils literal notranslate"><span class="pre">close</span></code>, se verá, pero no será accesible mediante selectores.</p>
<p>Si no ponemos el <code class="docutils literal notranslate"><span class="pre">shadowrootmode</span></code> en el <code class="docutils literal notranslate"><span class="pre">template</span></code> no se verá, si lo ponemos, ya sea open o close, se verá pero será o no accesible. Esto es porque <code class="docutils literal notranslate"><span class="pre">template</span></code> tiene dos propósitos, sin especificar el <code class="docutils literal notranslate"><span class="pre">shadowrootmode</span></code> es una plantilla útil para ser clonada, pero pensada para ser renderizada. Si lo ponemos como en el ejemplo, estamos indicando que requemos que actúe de <code class="docutils literal notranslate"><span class="pre">shadow</span> <span class="pre">root</span></code>.</p>
<p>Llegados a este punto, podemos poner esto en práctica copiando y pegando este código en la consola de cualquier web que tengamos abierta:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">host</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">host</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;closed&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">span</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">);</span>
<span class="nx">span</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;I&#39;m in the shadow DOM from Javascript&quot;</span><span class="p">;</span>
<span class="nx">shadow</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">span</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">host2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="nx">host2</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb">  &lt;template shadowrootmode=&quot;open&quot;&gt;</span>
<span class="sb">    &lt;span&gt;I&#39;m in the shadow DOM from HTML&lt;/span&gt;</span>
<span class="sb">  &lt;/template&gt;</span>
<span class="sb">`</span><span class="p">;</span>
<span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">host2</span><span class="p">);</span>
</pre></div>
</div>
<blockquote>
<div><p>El segundo no se va a ver porque innerHTML no crea el <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">Root</span></code>. Este, por javascript, ha de ser creado explícitamente como en el primer ejemplo. No obstante, aunque no se vea, el template queda accesible y puede ser clonado para incorporarlo más adelante.</p>
</div></blockquote>
<p>No es posible que un <code class="docutils literal notranslate"><span class="pre">Element</span></code> que actua como <code class="docutils literal notranslate"><span class="pre">shadow</span> <span class="pre">host</span></code> tenga tanto shadow-root como elementos hijos en el árbol principal. No da error, pero no serán visibles. De la misma manera, cualquier <code class="docutils literal notranslate"><span class="pre">div</span></code> o otros elementos que contengan <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> se convierte automáticamente en un <code class="docutils literal notranslate"><span class="pre">shadow</span> <span class="pre">host</span></code>, por lo que no puede tener otras etiquetas normales dentro.</p>
<p>los nodos descencientes del shadow-root no son accesibles mediante <code class="docutils literal notranslate"><span class="pre">document.querySelector</span></code>, por ejemplo. No obstante, son accesibles a través del atributo <code class="docutils literal notranslate"><span class="pre">shadowRoot</span></code>, el cual permite ejecutar <code class="docutils literal notranslate"><span class="pre">querySelector</span></code> internamente.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">host</span><span class="p">.</span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">);</span>
</pre></div>
</div>
<section id="estilos-en-shadow-dom">
<h3>Estilos en shadow DOM<a class="headerlink" href="#estilos-en-shadow-dom" title="Link to this heading">#</a></h3>
<p>Para dar estilo a un shadow DOM se puede hacer modificando <code class="docutils literal notranslate"><span class="pre">.style...</span></code> en los elementos hijos, poniendo la etiqueta <code class="docutils literal notranslate"><span class="pre">&lt;style&gt;</span></code> y escribiendo el CSS ahí mismo o importando los ficheros CSS.</p>
<p>Los estilos generales no se aplican a los elementos dentro del <code class="docutils literal notranslate"><span class="pre">shadow</span> <span class="pre">root</span></code>. En general es positivo que los estilos del DOM principal no afecten a los Web components. Esto los hace más robustos para poderlos reutilizar y que siempre se vean igual. También hace que sus estilos no puedan contaminar los de la web principal. No obstante, si estamos usando, por ejemplo, <code class="docutils literal notranslate"><span class="pre">Boostrap</span></code> tanto en el componente como en la web en general, podemos aplicar alguna de las técnicas que explicaremos a continuación:</p>
<p>Podemos usar un código como este en la creación del componente para que adopte las reglas del documento:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">adoptedStyleSheets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CSSStyleSheet</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">]</span>
<span class="w">  </span><span class="p">.</span><span class="nx">flatMap</span><span class="p">((</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[...</span><span class="nx">s</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">].</span><span class="nx">map</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">cssText</span><span class="p">))</span>
<span class="w">  </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
<span class="nx">adoptedStyleSheets</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">rules</span><span class="p">);</span>
<span class="nx">shadow</span><span class="p">.</span><span class="nx">adoptedStyleSheets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">adoptedStyleSheets</span><span class="p">];</span>
</pre></div>
</div>
<p>Aquí se ha obtenido la lista de reglas de todas las hojas de estilo y se han añadido al <code class="docutils literal notranslate"><span class="pre">shadow</span></code>. Para ello hay que transformar mediante flatMap y demás la lista de estilos, dentro de ellos las reglas y dentro las reglas en string, crear un <code class="docutils literal notranslate"><span class="pre">CSSStyleSheet</span></code> personalizado y añadir todas las reglas.</p>
<p>También se podrían buscar solo las reglas de un determinado tipo, una regla en concreto o las que vienen en un fichero.</p>
<p>En el caso de usar <code class="docutils literal notranslate"><span class="pre">Vite</span> <span class="pre">y</span> <span class="pre">Bootstrap</span></code>, podemos importar el css con <code class="docutils literal notranslate"><span class="pre">?inline</span></code>, lo cual importa el texto del css y no lo inyecta en la web (<a class="reference external" href="https://vitejs.dev/guide/features#disabling-css-injection-into-the-page">https://vitejs.dev/guide/features#disabling-css-injection-into-the-page</a>). Luego ese texto se puede usar tal cual en la plantilla. Observa el ejemplo:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">bootstrap</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;./styles.scss&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">styles</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;./styles.scss?inline&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#host&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">host</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;open&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">span</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="nx">span</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb"> &lt;style&gt;</span><span class="si">${</span><span class="nx">styles</span><span class="si">}</span><span class="sb">&lt;/style&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot;&gt;Primary&lt;/button&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot;&gt;Secondary&lt;/button&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; class=&quot;btn btn-success&quot;&gt;Success&lt;/button&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; class=&quot;btn btn-danger&quot;&gt;Danger&lt;/button&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; class=&quot;btn btn-warning&quot;&gt;Warning&lt;/button&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; class=&quot;btn btn-info&quot;&gt;Info&lt;/button&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; class=&quot;btn btn-light&quot;&gt;Light&lt;/button&gt;</span>
<span class="sb">&lt;button type=&quot;button&quot; &gt;Dark&lt;/button&gt;</span>
<span class="sb">`</span><span class="p">;</span>
<span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">span</span><span class="p">);</span>
</pre></div>
</div>
<section id="css-scopes-shadow-parts">
<h4>CSS Scopes / Shadow Parts<a class="headerlink" href="#css-scopes-shadow-parts" title="Link to this heading">#</a></h4>
<p>Si usamos en css la etiqueta en concreto si les afecta el css:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">custom-element</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<span class="w">  </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">black</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Para acceder desde dentro del <code class="docutils literal notranslate"><span class="pre">shadow</span> <span class="pre">root</span></code> al elemento que lo contiene, que es el <code class="docutils literal notranslate"><span class="pre">custom</span> <span class="pre">element</span></code> se puede usar <code class="docutils literal notranslate"><span class="pre">:host</span></code>, <code class="docutils literal notranslate"><span class="pre">host()</span></code> y <code class="docutils literal notranslate"><span class="pre">:host-context()</span></code>:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="nd">host</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<span class="w">  </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">black</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">span</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="kc">bold</span><span class="p">;</span>
<span class="w">  </span><span class="k">vertical-align</span><span class="p">:</span><span class="w"> </span><span class="kc">super</span><span class="p">;</span>
<span class="w">  </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="kc">small</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="templates">
<h2>Templates<a class="headerlink" href="#templates" title="Link to this heading">#</a></h2>
<p>Ya hemos visto en el apartado anterior que se pueden crear <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">Root</span></code> desde una <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code>. En los ejemplos anteriores eran usados con ese propósito, pero la etiqueta <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> también puede ser usada para hacer plantillas que no se van a ver hasta que se clonen.</p>
<p>Suponiendo que definimos esta plantilla:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;custom-paragraph&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>My paragraph<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Podemos crear un <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Component</span></code> de esta manera:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>
<span class="w">  </span><span class="s2">&quot;my-paragraph&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">super</span><span class="p">();</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;custom-paragraph&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">templateContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">shadowRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;open&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">      </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">templateContent</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Observemos que estamos extendiendo la clase <code class="docutils literal notranslate"><span class="pre">HTMLElement</span></code> dentro de la misma función <code class="docutils literal notranslate"><span class="pre">customElements.define()</span></code>, que creamos explícitamente el <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">Root</span></code> y que le añadimos un clon de la <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code>.</p>
<p>Es posible crear plantillas con <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> que puedan ser modificadas después de ser clonadas. Se puede hacer manualmente buscando dentro de ellas los elementos y cambiando su <code class="docutils literal notranslate"><span class="pre">innerText</span></code> o <code class="docutils literal notranslate"><span class="pre">value</span></code>. Por ejemplo, si tenemos que crear una tabla y poner datos en cada fila, podemos tener una plantilla para las filas y, en este caso, para la última columna:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;tableBodyTR&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>{id}<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{ejemplo}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;lastColumn&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;buttonsCol&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;edit&quot;</span><span class="p">&gt;</span>📝<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;delete&quot;</span><span class="p">&gt;</span>🗑️<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">lastColumnTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">div</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#lastColumn&quot;</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">tableBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">div</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#tableBody&quot;</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">tableBodyTR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">div</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#tableBodyTR&quot;</span><span class="p">);</span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">datos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">tableBodyTRRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tableBodyTR</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;tr&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">tableBodyTRRow</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">columns</span>
<span class="w">    </span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">col</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`&lt;td data-col=&quot;</span><span class="si">${</span><span class="nx">col</span><span class="si">}</span><span class="sb">&quot;&gt;</span><span class="si">${</span><span class="nx">row</span><span class="p">[</span><span class="nx">col</span><span class="p">]</span><span class="si">}</span><span class="sb">&lt;/td&gt;`</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lastColumnTemplate</span><span class="p">.</span><span class="nx">content</span>
<span class="w">    </span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;td&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">lastColumn</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">  </span><span class="nx">tableBodyTRRow</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">lastColumn</span><span class="p">);</span>
<span class="w">  </span><span class="nx">tableBody</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">tableBodyTRRow</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En el ejemplo anterior, la primera columna de la plantilla <code class="docutils literal notranslate"><span class="pre">tableBodyTR</span></code> desaparece por el innerHTML.</p>
<blockquote>
<div><p>Para usar <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> no es necesario estar en un <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Component</span></code>. Se puede usar en cualquier momento, por eso también está explicado en el capítulo del DOM.</p>
</div></blockquote>
<blockquote>
<div><p>Usar <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> tiene mucho más sentido si parte del HTML se genera en el servidor. Este puede enviar las plantillas dentro del documento y estas ser extraidas y utilizadas en el cliente. Si hacemos una SPA totalmente generada en el cliente, puede que sea más rápido usar las funciones del DOM o <code class="docutils literal notranslate"><span class="pre">template</span> <span class="pre">Literals</span></code>.</p>
</div></blockquote>
<section id="alternativa-con-template-literals">
<h3>Alternativa con Template Literals<a class="headerlink" href="#alternativa-con-template-literals" title="Link to this heading">#</a></h3>
<p>Usar <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> implica tener que buscarlo, clonarlo y modificarlo. En ocasiones es mucho más simple el uso de <code class="docutils literal notranslate"><span class="pre">Template</span> <span class="pre">Literals</span></code>. Incluso se puede hacer con <code class="docutils literal notranslate"><span class="pre">Tagged</span> <span class="pre">Template</span> <span class="pre">Literals</span></code> y queda un código más compacto. En el capítulo del DOM hay un ejemplo: <a class="reference external" href="https://xxjcaxx.github.io/libro_dwec/dom.html#creacion-de-elementos-mediante-tagged-template-literals">https://xxjcaxx.github.io/libro_dwec/dom.html#creacion-de-elementos-mediante-tagged-template-literals</a></p>
</section>
</section>
<section id="pasar-datos-al-componente">
<h2>Pasar datos al componente<a class="headerlink" href="#pasar-datos-al-componente" title="Link to this heading">#</a></h2>
<p>En los Web Components, a menudo hay que inicializarlos con algunos datos. Depende del propósito y cómo se añadan al DOM, se puede hacer de varias formas:</p>
<ul class="simple">
<li><p>Mediante el constructor</p></li>
<li><p>Mediante atributos</p></li>
<li><p>Mediante <code class="docutils literal notranslate"><span class="pre">data-</span></code></p></li>
<li><p>Mediante <code class="docutils literal notranslate"><span class="pre">slots</span></code></p></li>
<li><p>Mediante propiedades o métodos.</p></li>
<li><p>Mediante Observables (RxJS).</p></li>
<li><p>Elementos hijos con <slot></p></li>
<li><p>Custom Events</p></li>
</ul>
<section id="constructor-de-los-componentes">
<h3>Constructor de los componentes<a class="headerlink" href="#constructor-de-los-componentes" title="Link to this heading">#</a></h3>
<p>Como se trata de una clase, tiene constructor. Si lo creamos con <code class="docutils literal notranslate"><span class="pre">new</span></code>, podemos pasarle parámetros por ahí. Esta forma excluye el uso de la etiqueta en un HTML. La forma de crear un Web Component sería la siguente:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">MyComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">dataService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">dataService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dataService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">dataService</span><span class="p">.</span><span class="nx">fetchData</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;p&gt;</span><span class="si">${</span><span class="nx">data</span><span class="si">}</span><span class="sb">&lt;/p&gt;`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">dataService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DataService</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">myComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">(</span><span class="nx">dataService</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">myComponent</span><span class="p">);</span>
</pre></div>
</div>
<p>Como veremos más adelante, este método se llama <code class="docutils literal notranslate"><span class="pre">inyección</span> <span class="pre">de</span> <span class="pre">dependencias</span></code>.</p>
</section>
<section id="atributos">
<h3>Atributos<a class="headerlink" href="#atributos" title="Link to this heading">#</a></h3>
<p>Los atributos se pueden usar directamente en el HTML del componente para pasar datos. Se acceden dentro del componente con this.getAttribute().</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">my</span><span class="o">-</span><span class="nx">component</span><span class="w"> </span><span class="nx">nombre</span><span class="o">=</span><span class="s2">&quot;Juan&quot;</span><span class="o">&gt;&lt;</span><span class="err">/my-component&gt;</span>
<span class="p">...</span>
<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nx">MyComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;nombre&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;p&gt;Hola, </span><span class="si">${</span><span class="nx">nombre</span><span class="si">}</span><span class="sb">!&lt;/p&gt;`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;my-component&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">);</span>
</pre></div>
</div>
<blockquote>
<div><p>Hay que tener en cuenta que los atributos no son accesibles antes de que se añada al DOM. Por eso hay que acceder a ellos en en <code class="docutils literal notranslate"><span class="pre">connectedCallback</span></code>.</p>
</div></blockquote>
<p>Se puede lograr un comportamiento reactivo con los atributos, ya que tenemos <code class="docutils literal notranslate"><span class="pre">observedAttributes</span></code> y <code class="docutils literal notranslate"><span class="pre">attributeChangedCallback</span></code> que permite atender a los cambios en los atributos:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="nx">observedAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;alt&#39;</span><span class="p">];</span>

<span class="nx">attributeChangedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="nx">update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">img</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">img</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">img</span><span class="p">.</span><span class="nx">alt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;alt&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;avatar&#39;</span><span class="p">;</span><span class="w">    </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="data">
<h3><code class="docutils literal notranslate"><span class="pre">data-</span></code><a class="headerlink" href="#data" title="Link to this heading">#</a></h3>
<p>Es como los atributos pero más centralizado y accesible por <code class="docutils literal notranslate"><span class="pre">.dataset</span></code>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">my</span><span class="o">-</span><span class="nx">component</span><span class="w"> </span><span class="nx">data</span><span class="o">-</span><span class="nx">nombre</span><span class="o">=</span><span class="s2">&quot;María&quot;</span><span class="o">&gt;&lt;</span><span class="err">/my-component&gt;</span>
<span class="p">...</span>
<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nx">MyComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">nombre</span><span class="p">;</span><span class="w">  </span><span class="c1">// Accedemos con `dataset`</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;p&gt;Hola, </span><span class="si">${</span><span class="nx">nombre</span><span class="si">}</span><span class="sb">!&lt;/p&gt;`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;my-component&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">);</span>
</pre></div>
</div>
<p>Problemas de pasar datos como atributos o en el dataset:</p>
<ul class="simple">
<li><p>No se pueden para más que datos primitivos como string.</p></li>
<li><p>Si queremos pasar al componente un objeto complejo hay que serializarlo con <code class="docutils literal notranslate"><span class="pre">JSON.stringify()</span></code>.</p></li>
<li><p>Objetos complejos como Maps o Sets hay que convertirlos a Objects o Arrays antes de serializar.</p></li>
<li><p>Incluso si las string tienen comillas simples o dobles por el medio dan problemas tanto como atributos primitivos como dentro de objetos al serializar.</p></li>
<li><p>No es posible pasar funciones como atributos.</p></li>
</ul>
</section>
<section id="propiedades">
<h3>Propiedades<a class="headerlink" href="#propiedades" title="Link to this heading">#</a></h3>
<p>En este caso, los datos se pasan como propiedades de la instancia del componente en JavaScript. Las propiedades permiten una interacción más directa entre el componente y el código JavaScript que lo maneja.  Las propiedades no son visibles en el código HTML y pueden ser objetos más complejos que simples <code class="docutils literal notranslate"><span class="pre">strings</span></code> como, Sets, Maps, funciones o Observables.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">my</span><span class="o">-</span><span class="nx">component</span><span class="o">&gt;&lt;</span><span class="err">/my-component&gt;</span>
<span class="p">...</span>

<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nx">MyComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">set</span><span class="w"> </span><span class="nx">nombre</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;p&gt;Hola, </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">!&lt;/p&gt;`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;my-component&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">myComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;my-component&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">myComponent</span><span class="p">.</span><span class="nx">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Carlos&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Establecemos la propiedad desde JS</span>
</pre></div>
</div>
<p>En este ejemplo se usa un <code class="docutils literal notranslate"><span class="pre">Setter</span></code>, ya que el componente existirá antes de tener la propiedad. Pero si lo creamos por Javascript, podemos atender a esa propiedad en el <code class="docutils literal notranslate"><span class="pre">connectedCallback</span></code>.</p>
</section>
<section id="metodos">
<h3>Métodos<a class="headerlink" href="#metodos" title="Link to this heading">#</a></h3>
<p>Muy parecido a las propiedades, en este caso hacemos que una propiedad sea un método al que le pasamos los datos y este, por ejemplo, actualiza el componente:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">update</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;ul&gt;</span><span class="si">${</span><span class="nx">list</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`&lt;li&gt;</span><span class="si">${</span><span class="nx">item</span><span class="si">}</span><span class="sb">&lt;/li&gt;`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">&lt;/ul&gt;`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="observables">
<h3>Observables<a class="headerlink" href="#observables" title="Link to this heading">#</a></h3>
<p>Utilitzando RxJS, se puede hacer que un componente sea reactivo a los cambios de datos pasados como flujos de eventos (Observables). Esto es útil para gestionar flujos asíncronos de datos.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">my</span><span class="o">-</span><span class="nx">component</span><span class="o">&gt;&lt;</span><span class="err">/my-component&gt;</span>
<span class="p">...</span>
<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nx">MyComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">nombre$</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">BehaviorSubject</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Observable reactivo</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">nombre$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">nombre</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;p&gt;Hola, </span><span class="si">${</span><span class="nx">nombre</span><span class="si">}</span><span class="sb">!&lt;/p&gt;`</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">set</span><span class="w"> </span><span class="nx">nombre</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">nombre$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span><span class="w">  </span><span class="c1">// Emitimos el nuevo valor</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;my-component&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">MyComponent</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">myComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;my-component&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">myComponent</span><span class="p">.</span><span class="nx">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Ana&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Actualizamos el observable</span>
</pre></div>
</div>
</section>
<section id="slots">
<h3>Slots<a class="headerlink" href="#slots" title="Link to this heading">#</a></h3>
<p>Algunas veces se puede hacer más elegantemente con <code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code>. La etiqueta debe tener un <code class="docutils literal notranslate"><span class="pre">name</span></code> y permite ser sustituida.</p>
<p>Dentro de la plantilla se puede poner esta etiqueta de esta manera:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;my-text&quot;</span><span class="p">&gt;</span>My default text<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Y será incorporada en la plantilla en HTML así:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">my-paragraph</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">slot</span><span class="o">=</span><span class="s">&quot;my-text&quot;</span><span class="p">&gt;</span>Let&#39;s have some different text!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">my-paragraph</span><span class="p">&gt;</span>
</pre></div>
</div>
<section id="pasar-elementos-del-dom-como-hijos-del-web-component">
<h4>Pasar elementos del DOM como hijos del Web Component<a class="headerlink" href="#pasar-elementos-del-dom-como-hijos-del-web-component" title="Link to this heading">#</a></h4>
<p>El comportamiento por defecto es aceptar elementos dentro de la etiqueta. No obstante, si dentro del código del componente padre ponemos algo como <code class="docutils literal notranslate"><span class="pre">this.innerHTML</span> <span class="pre">=</span> <span class="pre">...</span></code> el componente hijo se sobrescribirá.</p>
<p>Veamos cómo crear un <code class="docutils literal notranslate"><span class="pre">badge</span></code> para que se muestre en la parte superior de una imagen:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span><span class="w"> </span><span class="nx">customBadge</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">#contentDiv</span><span class="p">;</span><span class="w"> </span><span class="c1">// Esto será inicializado</span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">observedAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">];</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="n">#contentDiv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="n">#contentDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="n">#contentDiv</span><span class="p">.</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;badge&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">shadowRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;closed&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">style</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb">            .badge-container {</span>
<span class="sb">                position: relative;</span>
<span class="sb">                display: inline-block;</span>
<span class="sb">            }</span>
<span class="sb">            .badge {</span>
<span class="sb">                position: absolute;</span>
<span class="sb">                top: 0;</span>
<span class="sb">                right: 0;</span>
<span class="sb">                background-color: red;</span>
<span class="sb">                color: white;</span>
<span class="sb">                border-radius: 50%;</span>
<span class="sb">                padding: 0.2em 0.5em;</span>
<span class="sb">                font-size: 0.75em;</span>
<span class="sb">                font-weight: bold;</span>
<span class="sb">            }</span>
<span class="sb">    `</span>
<span class="w">    </span><span class="c1">// Insertamos antes de los hijos que ya tiene, en vez de innerHTML</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">badgeContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">badgeContainer</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;badge-container&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;slot&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">badgeContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">slot</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">#contentDiv</span><span class="p">);</span>
<span class="w">    </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
<span class="w">    </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">badgeContainer</span><span class="p">);</span>

<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">attributeChangedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">#contentDiv</span><span class="p">)</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="n">#contentDiv</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;custom-badge&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">customBadge</span><span class="p">);</span>

<span class="nx">interval</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
<span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">numero</span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;custom-badge&#39;</span><span class="p">).</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="nx">numero</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>En este ejemplo hemos creado un badge que acepta un elemento hijo. Por un lado, tenemos un <code class="docutils literal notranslate"><span class="pre">shadow</span> <span class="pre">root</span></code> que incorpora tanto el estilo como el badge como los elementos hijos declararos explícitamente en el HTML. Para aceptar un elemento hijo, en este caso, usamos un slot que recogerá la imagen y la añadirá al <code class="docutils literal notranslate"><span class="pre">badgeContainer</span></code> y posteriormente al <code class="docutils literal notranslate"><span class="pre">shadowRoot</span></code>.</p>
<p>Este es un ejemplo de cómo añadirlo al HTML:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>    <span class="p">&lt;</span><span class="nt">custom-badge</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;6&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;javascript.svg&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 100px; height: 100px;&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">custom-badge</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="mediante-eventos">
<h3>Mediante Eventos<a class="headerlink" href="#mediante-eventos" title="Link to this heading">#</a></h3>
<p>Puesto que los componentes pueden emitir eventos, esto se puede usar para crear eventos personalizados para enviar información a los componentes padres. Incluso se puede hacer que un Web Component escuche los eventos en <code class="docutils literal notranslate"><span class="pre">document</span></code> para enviar información de unos componentes a otros.</p>
<p>Veremos un ejemplo en el apartado de mantener el estado de la aplicación.</p>
<p>Como hay muchas opciones, podemos ver esta tabla comparativa:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Método</strong></p></th>
<th class="head"><p><strong>Facilidad de uso en HTML</strong></p></th>
<th class="head"><p><strong>Soporte para objetos complejos o funciones</strong></p></th>
<th class="head"><p><strong>Facilidad de modificar durante ejecución</strong></p></th>
<th class="head"><p><strong>Usable antes de estar en el DOM</strong></p></th>
<th class="head"><p><strong>Posibilidad de que el componente tenga hijos</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Constructor</strong></p></td>
<td><p>No es usable directamente en HTML</p></td>
<td><p>Permite pasar cualquier tipo de dato</p></td>
<td><p>Permite modificar al crear el componente en JS</p></td>
<td><p>Datos accesibles desde la creación</p></td>
<td><p>Puede tener <code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code> o hijos sin problema</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Atributos</strong></p></td>
<td><p>Fácil de definir en HTML</p></td>
<td><p>Solo soporta valores de tipo cadena (también JSON)</p></td>
<td><p>Modificable con <code class="docutils literal notranslate"><span class="pre">setAttribute</span></code> o <code class="docutils literal notranslate"><span class="pre">attributeChangedCallback</span></code></p></td>
<td><p>Valores accesibles antes de conectar al DOM</p></td>
<td><p>Puede tener hijos o <code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><strong><code class="docutils literal notranslate"><span class="pre">data-*</span></code> Atributos</strong></p></td>
<td><p>Simple de usar en HTML</p></td>
<td><p>Solo soporta valores de tipo cadena aunque más organizados. (también JSON)</p></td>
<td><p>Modificable con <code class="docutils literal notranslate"><span class="pre">dataset</span></code> o <code class="docutils literal notranslate"><span class="pre">setAttribute</span></code></p></td>
<td><p>Accesible antes de estar en el DOM</p></td>
<td><p>Puede tener hijos o <code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Slots</strong></p></td>
<td><p>Requiere estructura HTML específica</p></td>
<td><p>Puede enviar texto o HTML</p></td>
<td><p>Baja. Cambiar el contenido del slot requiere manipulación del DOM</p></td>
<td><p>No. El contenido no está disponible hasta la conexión al DOM</p></td>
<td><p>Perfecto para componentes con estructura y contenido de hijos</p></td>
</tr>
<tr class="row-even"><td><p><strong>Propiedades o Métodos</strong></p></td>
<td><p>Usable solo en JavaScript</p></td>
<td><p>Permite pasar objetos y funciones</p></td>
<td><p>Las propiedades se pueden modificar directamente en el JS</p></td>
<td><p>Valores configurables antes y después de conectar</p></td>
<td><p>Permite tener hijos o <code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Observables (RxJS)</strong></p></td>
<td><p>Requiere suscripción</p></td>
<td><p>Puede manejar cualquier tipo de dato</p></td>
<td><p>Cambios reflejados en tiempo real con <code class="docutils literal notranslate"><span class="pre">subscribe</span></code></p></td>
<td><p>Sí, pero depende de la suscripción (mejor después de conectar)</p></td>
<td><p>Ideal para componentes con actualizaciones en vivo</p></td>
</tr>
<tr class="row-even"><td><p><strong>Elementos Hijos (<code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code>)</strong></p></td>
<td><p>Fácil de usar en HTML</p></td>
<td><p>Media-Alta. Permite estructuras complejas usando HTML o Custom Elements</p></td>
<td><p>Media. Cambios requieren manipulación del DOM o redefinir el contenido</p></td>
<td><p>No. Solo disponible después de conexión al DOM</p></td>
<td><p>Sí. Permite diseñar estructuras de componente con hijos o <code class="docutils literal notranslate"><span class="pre">slot</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eventos personalizados</strong></p></td>
<td><p>Fácil de usar en HTML</p></td>
<td><p>Media-Alta. Permite estructuras complejas usando HTML o Custom Elements</p></td>
<td><p>Media. Hay que implementar los eventos y escuchar otros eventos</p></td>
<td><p>No.</p></td>
<td><p>Sí.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="mantener-el-estado-de-la-aplicacion-con-componentes">
<h2>Mantener el estado de la aplicación con componentes<a class="headerlink" href="#mantener-el-estado-de-la-aplicacion-con-componentes" title="Link to this heading">#</a></h2>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/alternativasestado.png"><img alt="_images/alternativasestado.png" src="_images/alternativasestado.png" style="width: 423.0px; height: 273.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Decidiendo entre dos posibles gestiones del estado global.</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Mantener el estado es complejo. Podemos hechar mano de patrones de diseño. Por ejemplo, podemos centralizar el estado en un <code class="docutils literal notranslate"><span class="pre">Singleton</span></code> Observable y que todos los componentes se suscriban. Esto los hace muy acoplados con el estado global y puede ser complejo de gestionar en aplicaciones grandes. La solución puede ser usar la inyección de dependencias al construir el componente y así seguir manteniendo la aplicación desacoplada. Si optamos por esa alternativa sólo podemos crear los componentes por Javascript, ya que necesitamos usar el <code class="docutils literal notranslate"><span class="pre">constructor</span></code>.</p>
<section id="mantener-el-estado-con-inyeccion-de-dependencias">
<h3>Mantener el estado con Inyección de dependencias<a class="headerlink" href="#mantener-el-estado-con-inyeccion-de-dependencias" title="Link to this heading">#</a></h3>
<p>El framework <code class="docutils literal notranslate"><span class="pre">Angular</span></code> utiliza servicios que inyecta en los componentes. Con Javascript vanilla se puede conseguir algo similar.</p>
<section id="introduccion-a-la-inyeccion-de-dependencias">
<h4>Introducción a la inyección de dependencias<a class="headerlink" href="#introduccion-a-la-inyeccion-de-dependencias" title="Link to this heading">#</a></h4>
<p>Dejemos por un momento los Web Components para explicar la base teórica de la <code class="docutils literal notranslate"><span class="pre">DI</span></code> (Dependency injection). Supongamos que tenemos estas dos clases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="p">(()=&gt;{</span>
<span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nx">Api</span><span class="p">{</span>
<span class="w">        </span><span class="kr">constructor</span><span class="p">(){}</span>
<span class="w">        </span><span class="nx">post</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Api post&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nx">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">constructor</span><span class="p">(){</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Api</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">makeOrder</span><span class="p">(){</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">post</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Order</span><span class="p">();</span>
<span class="w">    </span><span class="nx">order</span><span class="p">.</span><span class="nx">makeOrder</span><span class="p">();</span>
<span class="p">})();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Api post
</pre></div>
</div>
</div>
</div>
<p>Los problemas de este enfoque son: dificultad para hacer pruebas (habrá que simular o interceptar métodos de la API antes de las llamadas reales) y poca flexibilidad. Si la clase de API se usa en varios servicios (como pedidos, carrito, usuario), reemplazarla por otra (por ejemplo, para cambiar de HTTP a WebSockets) implicaría modificar cada parte del código que la usa. La inyección de dependencias y un contenedor DI resolverían estos problemas al permitir una configuración declarativa que especifica las dependencias que cada clase debe usar.</p>
<p>La siguiente aproximación puede ser:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nx">Api</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="nx">post</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Api post&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nx">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">api</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">api</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">makeOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">post</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Order</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Api</span><span class="p">());</span>
<span class="w">    </span><span class="nx">order</span><span class="p">.</span><span class="nx">makeOrder</span><span class="p">();</span>
<span class="p">})();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Api post
</pre></div>
</div>
</div>
</div>
<p>En este caso, la clase order ya no gestiona la creación de su dependencia. El siguiente problema es que se pueden crear muchas instancias de la Api por distintos componentes y si el servicio mantiene el estado puede ser un problema tener varios estados. Mediante el patrón <code class="docutils literal notranslate"><span class="pre">Singleton</span></code> se consigue tener un sólo estado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nx">Api</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">        </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">Api</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">Api</span><span class="p">.</span><span class="nx">instance</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">Api</span><span class="p">.</span><span class="nx">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">post</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Api post&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nx">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">api</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">api</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">makeOrder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">post</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Order</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Api</span><span class="p">());</span>
<span class="w">    </span><span class="nx">order</span><span class="p">.</span><span class="nx">makeOrder</span><span class="p">();</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">order2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Order</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Api</span><span class="p">());</span>
<span class="w">    </span><span class="nx">order2</span><span class="p">.</span><span class="nx">makeOrder</span><span class="p">();</span>
<span class="w">    </span><span class="nx">order</span><span class="p">.</span><span class="nx">makeOrder</span><span class="p">();</span>
<span class="w">    </span><span class="nx">order2</span><span class="p">.</span><span class="nx">makeOrder</span><span class="p">();</span>
<span class="p">})();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Api post <span class=" -Color -Color-Yellow">1</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Api post <span class=" -Color -Color-Yellow">2</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Api post <span class=" -Color -Color-Yellow">3</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Api post <span class=" -Color -Color-Yellow">4</span>
</pre></div>
</div>
</div>
</div>
<p>Aún tenemos el problema de tener que ir construyendo <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Api()</span></code> en muchos sitios. En caso de que el constructor de <code class="docutils literal notranslate"><span class="pre">Api</span></code>necesite parámetros, hay que ir repitiendo por todo el código y es difícil de mantener. Para solucionar este problema podemos recurrir al patrón <code class="docutils literal notranslate"><span class="pre">Factory</span></code> y centralizar la creación de objetos o usar técnicas más avanzadas como <code class="docutils literal notranslate"><span class="pre">proxies</span></code> (tutorial con proxies: <a class="reference external" href="https://medium.com/&#64;sasha.kub95/dependency-injection-di-and-di-container-with-vanilla-javascript-adb888498bd">https://medium.com/&#64;sasha.kub95/dependency-injection-di-and-di-container-with-vanilla-javascript-adb888498bd</a> )</p>
</section>
<section id="di-en-web-components">
<h4>DI en Web Components<a class="headerlink" href="#di-en-web-components" title="Link to this heading">#</a></h4>
<p>En los Web Components contamos con una dificultad extra. Puesto que podemos necesitar crearlos sin javascript directamente en HTML, no podemos llamar a su constructor explícitamente para inyectarle las dependencias.</p>
<p>Una de las posibles soluciones es usar un contenedor global de dependencias. Este puede estar disponible para todos los componentes. Los componentes dependen del contenedor para acceder a sus servicios. Si bien el contenedor centraliza las dependencias y simplifica la gestión, esto puede crear un acoplamiento con el propio contenedor, haciéndolo menos flexible si se necesita cambiar la estrategia de inyección.</p>
<p>Ejemplo:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">contenedorDependencias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">apiService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ApiService</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">logService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">LogService</span><span class="p">();</span>

<span class="nx">contenedorDependencias</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;apiService&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">apiService</span><span class="p">);</span>
<span class="nx">contenedorDependencias</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;logService&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">logService</span><span class="p">);</span>


<span class="kd">class</span><span class="w"> </span><span class="nx">ComponenteUsuario</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Obtenemos el servicio necesario del contenedor</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contenedorDependencias</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">api_service</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">logService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contenedorDependencias</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">log_service</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>

<span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;componente-usuario&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">ComponenteUsuario</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">componente-usuario</span> <span class="na">data-api_service</span><span class="o">=</span><span class="s">&quot;apiService&quot;</span> <span class="na">data-log_service</span><span class="o">=</span><span class="s">&quot;logService&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">componente-usuario</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Este enfoque te permite manejar las dependencias de manera flexible y desacoplada usando un contenedor <code class="docutils literal notranslate"><span class="pre">Map</span></code>. Al utilizar <code class="docutils literal notranslate"><span class="pre">dataset</span></code> para especificar las claves de dependencia en HTML, se puede reutilizar el componente <code class="docutils literal notranslate"><span class="pre">ComponenteUsuario</span></code> en diferentes contextos sin modificar su código interno.</p>
</section>
</section>
<section id="mantener-el-estado-con-un-context-provider">
<h3>Mantener el estado con un Context Provider<a class="headerlink" href="#mantener-el-estado-con-un-context-provider" title="Link to this heading">#</a></h3>
<p>Por otro lado, podemos hacer que el estado se comunique entre componentes hijos y padres a través de atributos o propiedades (de padres a hijos) o eventos (de hijos a padres). Este enfoque tiene el problema de tener que pasar atributos que no necesitan los hijos intermedios.</p>
<p>Para evitar lo que en <code class="docutils literal notranslate"><span class="pre">react</span></code> llaman el <code class="docutils literal notranslate"><span class="pre">Prop</span> <span class="pre">Drilling</span></code> podemos centralizar el estado de alguna manera (Objetos, Sets, Maps, Observables, Redux…) y hacerlo accesible desde un componente que los contenga a todos.</p>
<p>Para hacer que algo que está en el primer nivel del DOM pueda compartir el estado con cualquier hijo se puede hacer con eventos y callblacks. El elemento hijo que necesite consultar el estado, puede enviar un evento y en el mensaje del evento incorporar un callback. El elemento que lo atienda (<code class="docutils literal notranslate"><span class="pre">context</span> <span class="pre">provider</span></code>), ejecutará ese callback  así le pasará el estado al elemento que ha lanzado el evento.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="_images/estadocomponentes.png"><img alt="_images/estadocomponentes.png" src="_images/estadocomponentes.png" style="width: 569.25px; height: 406.5px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Diagrama de la petición y paso del contexto</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>En el siguiente ejemplo, el <code class="docutils literal notranslate"><span class="pre">CustomInput</span></code> emite un evento informando de su función para inicializar su <code class="docutils literal notranslate"><span class="pre">Observable</span></code> que atenderá a los cambios en el <code class="docutils literal notranslate"><span class="pre">context</span></code>. El componente <code class="docutils literal notranslate"><span class="pre">CustomApp</span></code> atiende a ese tipo de eventos ejecutando la función de <code class="docutils literal notranslate"><span class="pre">callback</span></code> que le ha enviado. Esta función, en este caso, se subscribe al <code class="docutils literal notranslate"><span class="pre">Subject</span></code> que le ha pasado y a partir de ahí se actualizará cada vez que cambie ese dato en el <code class="docutils literal notranslate"><span class="pre">context</span></code>. De esta manera, el estado global de la aplicación queda centralizado en un Map accesible para cualquier otro componente.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nx">CustomInput</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">super</span><span class="p">();</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">shadowContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newValue</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">requestAnimationFrame</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span>
<span class="w">          </span><span class="ow">new</span><span class="w"> </span><span class="nx">CustomEvent</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bubbles</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nx">detail</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nx">setObservable</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">stateSubscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newValue</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
<span class="w">              </span><span class="p">},</span>
<span class="w">              </span><span class="nx">requestedValue</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">name</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">          </span><span class="p">})</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shadowContainer</span><span class="p">);</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">shadowRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">shadowContainer</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;closed&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">      </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">disconnectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">stateSubscription</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;custom-input&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">CustomInput</span><span class="p">);</span>

<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nx">CustomApp</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">super</span><span class="p">();</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">$context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">BehaviorSubject</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">);</span>

<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">initSubscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fromEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;init&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
<span class="w">          </span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$context</span><span class="p">),</span>
<span class="w">          </span><span class="nx">map</span><span class="p">(([</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">newContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">structuredClone</span><span class="p">(</span><span class="nx">context</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span>
<span class="w">              </span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">requestedValue</span><span class="p">,</span>
<span class="w">              </span><span class="s2">&quot;Initial Value&quot;</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">newContext</span><span class="p">;</span>
<span class="w">          </span><span class="p">}),</span>
<span class="w">          </span><span class="nx">tap</span><span class="p">((</span><span class="nx">newContext</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">setObservable</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$context</span><span class="p">))</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">$context</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">c</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">disconnectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">initSubscription</span><span class="o">?</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;custom-app&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">CustomApp</span><span class="p">);</span>
</pre></div>
</div>
<p>Código HTML para usarlos:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>   <span class="p">&lt;</span><span class="nt">custom-app</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Ejemplo del contexto<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">custom-div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">custom-input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ejemploInput&quot;</span><span class="p">&gt;</span>
            
          <span class="p">&lt;/</span><span class="nt">custom-input</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">custom-div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">custom-app</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>En este artículo lo explican con detalle sin usar RxJS: <a class="reference external" href="https://plainvanillaweb.com/blog/articles/2024-10-07-needs-more-context/">https://plainvanillaweb.com/blog/articles/2024-10-07-needs-more-context/</a></p>
<p>En el ejemplo no es necesario porque el evento es enviado desde fuera del shadow dom, pero si queremos que el evento de dentro se expanda, hay que añadir <code class="docutils literal notranslate"><span class="pre">composed:</span> <span class="pre">true</span></code> y eso hará que salga del shadow dom.</p>
<p>Veamos esta tabla comparativa:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Característica</p></th>
<th class="head"><p><strong>Inyección de Dependencias (DI)</strong></p></th>
<th class="head"><p><strong>Servicio Global</strong></p></th>
<th class="head"><p><strong>Context Provider</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Desacoplamiento</strong></p></td>
<td><p>Alto. Los componentes dependen de la interfaz del servicio, no de su implementación.</p></td>
<td><p>Bajo. Los componentes dependen del contexto global, lo que los acopla a la estructura global de la app.</p></td>
<td><p>Medio. Los componentes dependen del contenedor pero no directamente del servicio.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Facilidad de uso en HTML</strong></p></td>
<td><p>Baja. La inyección en el constructor impide instanciación directa en HTML. Requiere inyección manual (constructor o setters).</p></td>
<td><p>Alta. No hay restricciones para la instanciación en HTML.</p></td>
<td><p>Alta. Los componentes pueden instanciarse en HTML dentro del contenedor.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Escalabilidad</strong></p></td>
<td><p>Alta. Facilita agregar o cambiar servicios sin modificar componentes.</p></td>
<td><p>Baja. El uso de servicios globales tiende a ser más difícil de gestionar en aplicaciones grandes.</p></td>
<td><p>Media-Alta. Escalable para componentes anidados, pero puede ser confuso con varios contextos.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Pruebas Unitarias</strong></p></td>
<td><p>Alta. Facilita el uso de mocks/stubs en lugar del servicio real, mejorando pruebas unitarias.</p></td>
<td><p>Baja. El servicio global está acoplado, lo que dificulta el uso de mocks/stubs en pruebas.</p></td>
<td><p>Media. Es fácil sustituir el <code class="docutils literal notranslate"><span class="pre">ContextProvider</span></code> o inyectar el servicio en pruebas.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Persistencia de Estado</strong></p></td>
<td><p>Alta. Cada componente tiene su instancia inyectada, manteniendo el estado donde sea necesario.</p></td>
<td><p>Alta. El estado es global, compartido y persistente en toda la aplicación.</p></td>
<td><p>Alta. Los datos pueden persistir mientras el contenedor esté activo, ofreciendo un “estado local compartido”.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Flexibilidad para Reemplazar Servicios</strong></p></td>
<td><p>Alta. La dependencia puede reemplazarse fácilmente al inyectarla, permitiendo alternar entre implementaciones.</p></td>
<td><p>Baja. Reemplazar un servicio global afecta toda la aplicación y necesita cuidado adicional.</p></td>
<td><p>Media. El contexto puede ser reemplazado cambiando el proveedor, sin modificar los componentes.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Propenso a Errores en Tiempo de Ejecución</strong></p></td>
<td><p>Medio. Requiere asegurar que el servicio esté inyectado antes de usarlo.</p></td>
<td><p>Alto. Cualquier cambio en el servicio global afecta toda la aplicación, propenso a efectos colaterales.</p></td>
<td><p>Medio. Hay que asegurarse de que los hijos estén dentro del proveedor de contexto, sino no recibirán el servicio.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Mantenimiento</strong></p></td>
<td><p>Alto. Buen mantenimiento en aplicaciones grandes, especialmente con servicios independientes y bien definidos.</p></td>
<td><p>Bajo. El uso excesivo de servicios globales aumenta el acoplamiento y la dificultad de mantener la estructura.</p></td>
<td><p>Medio-Alto. Adecuado para componentes hijos, pero puede ser complejo con muchos contextos anidados.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Rendimiento</strong></p></td>
<td><p>Medio. Cada componente que recibe el servicio inyectado tiene su propia referencia, sin problemas significativos de rendimiento.</p></td>
<td><p>Alto. El servicio es accesible en todo momento, sin sobrecarga en inyección o propagación.</p></td>
<td><p>Medio. Algunos eventos adicionales pueden afectar el rendimiento si hay muchas actualizaciones de contexto.</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><strong>Inyección de Dependencias (DI)</strong>: Ideal para aplicaciones donde el desacoplamiento es crucial, como en proyectos medianos o grandes con muchos componentes reutilizables. La DI es especialmente útil cuando quieres que los componentes sean fáciles de probar y de mantener con configuraciones dinámicas de servicios.</p></li>
<li><p><strong>Servicio Global</strong>: Útil en aplicaciones pequeñas donde la simplicidad es más importante que la modularidad o el desacoplamiento. Es un buen enfoque si el servicio es fundamental para toda la aplicación (por ejemplo, un usuario autenticado) y se usará de manera uniforme en todos los componentes.</p></li>
<li><p><strong>Context Provider</strong>: Aporta un buen equilibrio entre desacoplamiento y accesibilidad en aplicaciones con jerarquías complejas de componentes. Es adecuado cuando varios componentes deben compartir un estado, pero solo dentro de una sección de la aplicación (por ejemplo, el estado de un tema visual en una subaplicación).</p></li>
</ul>
</section>
</section>
<section id="ejemplo-completo">
<h2>Ejemplo completo<a class="headerlink" href="#ejemplo-completo" title="Link to this heading">#</a></h2>
<p>Presuponemos un proyecto usando <code class="docutils literal notranslate"><span class="pre">Vite</span></code>, <code class="docutils literal notranslate"><span class="pre">Bootstrap</span></code> y <code class="docutils literal notranslate"><span class="pre">RxJS</span></code>.</p>
<p>La idea es crear un formulario reactivo como un <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Component</span></code>. Para ello vamos a utilizar muchas de las técnicas explicadas, aunque alguna la podríamos omitir. En primer lugar, podemos crear una plantilla para el formulario con <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> y <code class="docutils literal notranslate"><span class="pre">&lt;slot&gt;</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">plantillaFormulario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb">    &lt;div class=&quot;container mt-5&quot;&gt;</span>
<span class="sb">      &lt;h2 class=&quot;mb-4&quot;&gt;</span>
<span class="sb">      &lt;slot name=&quot;titulo&quot;&gt;Formulario reactivo&lt;/slot&gt;</span>
<span class="sb">      &lt;/h2&gt;</span>
<span class="sb">      &lt;form id=&quot;formularioReactivo&quot;&gt;</span>
<span class="sb">        &lt;!-- Campo de texto --&gt;</span>
<span class="sb">        &lt;div class=&quot;mb-3&quot;&gt;</span>
<span class="sb">          &lt;label for=&quot;nombre&quot; class=&quot;form-label&quot;&gt;Nombre&lt;/label&gt;</span>
<span class="sb">          &lt;input</span>
<span class="sb">            type=&quot;text&quot;</span>
<span class="sb">            class=&quot;form-control&quot;</span>
<span class="sb">            id=&quot;nombre&quot;</span>
<span class="sb">            placeholder=&quot;Ingresa tu nombre&quot;</span>
<span class="sb">            required</span>
<span class="sb">            name=&quot;nombre&quot;</span>
<span class="sb">          /&gt;</span>
<span class="sb">        &lt;/div&gt;</span>

<span class="sb">        &lt;!-- Campo de correo electrónico --&gt;</span>
<span class="sb">        &lt;div class=&quot;mb-3&quot;&gt;</span>
<span class="sb">          &lt;label for=&quot;email&quot; class=&quot;form-label&quot;&gt;Correo Electrónico&lt;/label&gt;</span>
<span class="sb">          &lt;input</span>
<span class="sb">            type=&quot;email&quot;</span>
<span class="sb">            class=&quot;form-control&quot;</span>
<span class="sb">            id=&quot;email&quot;</span>
<span class="sb">            placeholder=&quot;Ingresa tu correo electrónico&quot;</span>
<span class="sb">            required</span>
<span class="sb">            name=&quot;correo&quot;</span>
<span class="sb">          /&gt;</span>
<span class="sb">        &lt;/div&gt;</span>

<span class="sb">        &lt;!-- Botón de enviar --&gt;</span>
<span class="sb">        &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Enviar&lt;/button&gt;</span>
<span class="sb">      &lt;/form&gt;</span>
<span class="sb">      &lt;div&gt;</span>
<span class="sb">        &lt;p&gt;&lt;strong&gt;Valor Nombre:&lt;/strong&gt; </span>
<span class="sb">        &lt;span id=&quot;nombre-output&quot;&gt;&lt;/span&gt;</span>
<span class="sb">        &lt;/p&gt;</span>
<span class="sb">        &lt;p&gt;</span>
<span class="sb">          &lt;strong&gt;Valor Correo Electrónico:&lt;/strong&gt;</span>
<span class="sb">          &lt;span id=&quot;email-output&quot;&gt;&lt;/span&gt;</span>
<span class="sb">        &lt;/p&gt;</span>
<span class="sb">      &lt;/div&gt;</span>
<span class="sb">    &lt;/div&gt;</span>
<span class="sb">`</span><span class="p">;</span>
</pre></div>
</div>
<p>En la tercera línea hay <code class="docutils literal notranslate"> <span class="pre">&lt;slot</span> <span class="pre">name=&quot;titulo&quot;&gt;Formulario</span> <span class="pre">reactivo&lt;/slot&gt;</span></code> que luego será reemplazado. Por lo demás, es un formulario normal.</p>
<p>Para crear el <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Component</span></code> vamos a usar una función. De esta manera, se puede reutilizar un poco más el código y se aproxima más a la programación funcional:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">createCustomFormComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="c1">// Object destructuring</span>
<span class="w">  </span><span class="nx">tag</span><span class="p">,</span>
<span class="w">  </span><span class="nx">template</span><span class="p">,</span>
<span class="w">  </span><span class="nx">keyUpFunction</span><span class="p">,</span><span class="w"> </span>
<span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nx">customComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">HTMLElement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">super</span><span class="p">();</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">dataSubject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Subject</span><span class="p">();</span><span class="w"> </span><span class="c1">// La manera de obtener datos del padre</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">templateComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">templateComponent</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">template</span><span class="p">;</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">shadowRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;closed&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="w">      </span><span class="c1">// Este paso es redundante e innecesario en este caso ya que estamos creando la plantilla dinámicamente</span>
<span class="w">      </span><span class="c1">// Lo dejamos para dejar la referencia a las funciones en un mismo ejemplo.</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">contentFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">templateComponent</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contentFragment</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">      </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="nx">tag</span><span class="p">,</span><span class="w"> </span><span class="nx">customComponent</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>En este caso es un componente para crear diversos formularios reactivos. Necesita para ser inicializado el <code class="docutils literal notranslate"><span class="pre">tag</span></code>, una plantilla del formulario que tenga inputs con el atributo <code class="docutils literal notranslate"><span class="pre">name</span></code> y una función para indicar qué hacer cuando ocurra un cambio en el formulario.
Esta función ya registra el componente.</p>
<p>Al <code class="docutils literal notranslate"><span class="pre">connectedCallback</span></code> le añadiremos las subscipciones necesarias para implementar la reactividad interna y externa:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">connectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">templateComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">templateComponent</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">template</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">shadowRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span><span class="w"> </span><span class="nx">mode</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;closed&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Este paso es redundante e innecesario en este caso ya que estamos creando la plantilla dinámicamente</span>
<span class="w">        </span><span class="c1">// Lo dejamos para dejar la referencia a las funciones en un mismo ejemplo. </span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">contentFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">templateComponent</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contentFragment</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// El evento de keyup tratado de forma reactiva </span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">keyUpSubscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fromEvent</span><span class="p">(</span><span class="nx">shadowRoot</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;keyup&#39;</span><span class="p">)</span>
<span class="w">          </span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
<span class="w">            </span><span class="nx">map</span><span class="p">((</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">(</span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">))),</span>
<span class="w">            </span><span class="nx">distinctUntilChanged</span><span class="p">(</span>
<span class="w">              </span><span class="p">(</span><span class="nx">previous</span><span class="p">,</span><span class="w"> </span><span class="nx">current</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">                </span><span class="p">[...</span><span class="nx">previous</span><span class="p">.</span><span class="nx">entries</span><span class="p">()]</span>
<span class="w">                  </span><span class="p">.</span><span class="nx">every</span><span class="p">(</span>
<span class="w">                    </span><span class="p">([</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">],</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">                      </span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="p">[...</span><span class="nx">current</span><span class="p">.</span><span class="nx">entries</span><span class="p">()][</span><span class="nx">index</span><span class="p">][</span><span class="mf">1</span><span class="p">]</span>
<span class="w">                  </span><span class="p">)),</span>
<span class="w">            </span><span class="nx">debounceTime</span><span class="p">(</span><span class="mf">200</span><span class="p">)</span>
<span class="w">          </span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">values</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Evento para informar al componente padre de un cambio</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">customEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">CustomEvent</span><span class="p">(</span><span class="s1">&#39;formChanged&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nx">bubbles</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">              </span><span class="nx">detail</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Form changed&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">customEvent</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// Implementar la reactividad en el mismo formulario</span>
<span class="w">            </span><span class="nx">keyUpFunction</span><span class="p">(</span><span class="nx">shadowRoot</span><span class="p">)(</span><span class="nx">values</span><span class="p">);</span>
<span class="w">          </span><span class="p">});</span>

<span class="w">          </span><span class="c1">// Atender a los datos externos</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">dataSubscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">dataSubject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="p">[...</span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)]</span>
<span class="w">          </span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">input</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">[</span><span class="nx">input</span><span class="p">.</span><span class="nx">name</span><span class="p">]);</span>
<span class="w">          </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">KeyboardEvent</span><span class="p">(</span><span class="s1">&#39;keyup&#39;</span><span class="p">));</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span>
</pre></div>
</div>
<p>En este caso, nos interesa atender a los eventos <code class="docutils literal notranslate"><span class="pre">keyup</span></code> que modifiquen el formulario (<code class="docutils literal notranslate"><span class="pre">distinctUntilChanged</span></code>) con un cierto <code class="docutils literal notranslate"><span class="pre">debounceTime</span></code> para no saturar con cambios al componente padre. Cuando esto ocurre emitimos un evento personalizado, que es la manera de comunicar los cambios al componente padre. Luego se ejecuta la <code class="docutils literal notranslate"><span class="pre">keyUpFunction</span></code> tanto con el contenedor como con los últimos valores para que haga lo que se considere necesario. Esta función pasada como parámetros podría validad el formulario o, como en el caso que nos ocupa, mostrar los datos en otro sitio dentro del formulario.</p>
<p>Es importante quitar todas las suscripciones a observables si se elimina el componente:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nx">disconnectedCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">keyUpSubscription</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">dataSubscription</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
</pre></div>
</div>
<p>Para crear el componente invocaremos a la función:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nx">createCustomFormComponent</span><span class="p">(</span>
<span class="w">    </span><span class="p">{</span><span class="w">  </span><span class="c1">// Al pasar un objeto como parámetro, podemos asignar los nombres de los atributos y desordenarlos.</span>
<span class="w">      </span><span class="nx">tag</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;custom-formularioreactivo&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">template</span><span class="o">:</span><span class="w"> </span><span class="nx">plantillaFormulario</span><span class="p">,</span>
<span class="w">      </span><span class="nx">keyUpFunction</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">shadowRoot</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">values</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">[...</span><span class="nx">values</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="sb">`#</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">-output`</span><span class="p">).</span><span class="nx">innerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
<p>Como se puede ver, la <code class="docutils literal notranslate"><span class="pre">keyUpFunction</span></code> usará los valores del formulario para cambiar el contenido de ciertos elementos de la <code class="docutils literal notranslate"><span class="pre">plantillaFormulario</span></code></p>
<p>Luego lo incorporamos a la web, por ejemplo:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">customFormulario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;custom-formularioreactivo&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Crear el span con el slot=&quot;titulo&quot;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">spanTitulo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">spanTitulo</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;slot&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;titulo&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">spanTitulo</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Formulario reactivo con el titulo en slot&#39;</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Añadir el span al custom element</span>
<span class="w">  </span><span class="nx">customFormulario</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">spanTitulo</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Insertar el custom element en el DOM</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#reactividad&quot;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">customFormulario</span><span class="p">);</span>
</pre></div>
</div>
<p>Ahora podemos comprobar que realmente es reactivo. Si modificamos inputs del formulario se ven los cambios. Pero también informa de los cambios al componente padre:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">// Atender al evento </span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#reactividad&quot;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;formChanged&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
</pre></div>
</div>
<p>Con este código vemos que los cambios internos son devueltos como eventos personalizados.</p>
<p>Y el componente personalizado también se puede actualizar</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nx">interval</span><span class="p">(</span><span class="mf">1000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
<span class="w">    </span><span class="nx">map</span><span class="p">(</span><span class="nx">i</span><span class="p">=&gt;({</span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="nx">i</span><span class="p">}))</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">customFormulario</span><span class="p">.</span><span class="nx">dataSubject</span><span class="p">)</span>
</pre></div>
</div>
<p>Este código suscribe el subject interno del componente a un observable externo y esto provoca todos los cambios reactivamente.</p>
</section>
<section id="conclusiones">
<h2>Conclusiones<a class="headerlink" href="#conclusiones" title="Link to this heading">#</a></h2>
<p>Como se ve en todo este capítulo, hay muchas opciones para hacer Web Components. En la práctica se vuelve casi imprescindible para proyectos grandes y para reutilizar dentro del mismo proyecto o en otros. Se han mencionado alternativas a todo y ventajas y desventajas, pero no una guía definitiva porque no la hay, depende del tipo de proyecto. Así que vamos a hacer una breve reseña de cada técnica y el tipo de web adecuado:</p>
<p>Para una web estática en HTML que necesite Web Components se puede usar <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code>. En cuanto a la comunicación y el estado de la aplicación, como se supone que vienen del servidor no hace falta mucha sofisticación. Tal vez pasar los datos por atributos o dataset. Puede ser útil hacer Web Components con Shadow DOM que se puedan reutilizar en otras webs.</p>
<p>Para una web generada en el servidor con PHP, Python, Java, Node… y “hidratada” con javascript, también se puede usar <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> generados por el servidor. En este caso ya puede ser que necesitemos usar propiedades o observables para lograr la reactividad. También hay que plantearse si gestionar el estado de forma sofisticada.</p>
<p>Para una SPA que consume los datos en formato JSON de una API, sería mejor usar <code class="docutils literal notranslate"><span class="pre">template</span> <span class="pre">literals</span></code> o <code class="docutils literal notranslate"><span class="pre">document.createElement</span></code> y el resto de funciones para generar dinámicamente los <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Components</span></code>. Puesto que no es necesario que se pongan en el HTML, lo podemos crear diréctamente en JS y así poder asignarle propiedades más que atributos o data. También hay que mantener muy bien el estado de la aplicación. Para ello o usamos servicios con inyección de dependencias o context providers.</p>
<p>En cuanto a los estilos, ya depende de la reusabilidad de los componentes la decisión de implementar <code class="docutils literal notranslate"><span class="pre">Shadow</span> <span class="pre">Dom</span></code> o depender de estilos globales.</p>
<p>Lecturas:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components:">https://developer.mozilla.org/en-US/docs/Web/API/Web_components:</a> Guia principal de referencia.</p></li>
<li><p><a class="github reference external" href="https://github.com/mdn/web-components-examples:">mdn/web-components-examples:</a> Ejemplos de Custom Elements de la MDN.</p></li>
<li><p><a class="reference external" href="https://es.javascript.info/web-components">https://es.javascript.info/web-components</a> Otro muy buen manual.</p></li>
<li><p><a class="reference external" href="https://learn-wcs.com/?active-item=why-web-components">https://learn-wcs.com/?active-item=why-web-components</a> Colección de enlaces muy buena.</p></li>
<li><p><a class="reference external" href="https://positive-intentions.com/blog/dim-functional-webcomponents/">https://positive-intentions.com/blog/dim-functional-webcomponents/</a> Un ejemplo de programación funcional y reactiva con Web Components</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "deno"
        },
        kernelOptions: {
            name: "deno",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'deno'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="webworkers.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Web Workers</p>
      </div>
    </a>
    <a class="right-next"
       href="supabase.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Supabase: (Backend como Servicio)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptos-iniciales">Conceptos iniciales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternativas">Alternativas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-elements">Custom Elements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-de-vida">Ciclo de vida</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#registrar-el-elemento-personalizado">Registrar el elemento personalizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usar-el-elemento-personalizado">Usar el elemento personalizado</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shadow-dom">Shadow DOM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estilos-en-shadow-dom">Estilos en shadow DOM</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#css-scopes-shadow-parts">CSS Scopes / Shadow Parts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#templates">Templates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternativa-con-template-literals">Alternativa con Template Literals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pasar-datos-al-componente">Pasar datos al componente</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructor-de-los-componentes">Constructor de los componentes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atributos">Atributos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data"><code class="docutils literal notranslate"><span class="pre">data-</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#propiedades">Propiedades</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos">Métodos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observables">Observables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slots">Slots</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pasar-elementos-del-dom-como-hijos-del-web-component">Pasar elementos del DOM como hijos del Web Component</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mediante-eventos">Mediante Eventos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mantener-el-estado-de-la-aplicacion-con-componentes">Mantener el estado de la aplicación con componentes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mantener-el-estado-con-inyeccion-de-dependencias">Mantener el estado con Inyección de dependencias</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion-a-la-inyeccion-de-dependencias">Introducción a la inyección de dependencias</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#di-en-web-components">DI en Web Components</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mantener-el-estado-con-un-context-provider">Mantener el estado con un Context Provider</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejemplo-completo">Ejemplo completo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">Conclusiones</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jose Castillo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>