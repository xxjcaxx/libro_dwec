
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Supabase: (Backend como Servicio) &#8212; Libro DWEC</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=dd2cc81e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'supabase';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="NPM" href="npm.html" />
    <link rel="prev" title="Comunicación con el servidor" href="ajax.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Libro DWEC - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Libro DWEC - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Desarrollo Web en Entorno Cliente (DWEC)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Javascript</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="desarrollofrontend.html">La Web y el Desarrollo Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="lenguajejavascript.html">El lenguaje Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="arraysobjetosclases.html">Arrays Objetos y clases</a></li>
<li class="toctree-l1"><a class="reference internal" href="dom.html">DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="iteradores.html">Iteradores</a></li>
<li class="toctree-l1"><a class="reference internal" href="modulos.html">Módulos</a></li>
<li class="toctree-l1"><a class="reference internal" href="promesas.html">Asincronía y Promesas</a></li>
<li class="toctree-l1"><a class="reference internal" href="ajax.html">Comunicación con el servidor</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Supabase: (Backend como Servicio)</a></li>
<li class="toctree-l1"><a class="reference internal" href="npm.html">NPM</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="programacionfuncionalreactiva.html">Programación Funcional, Asíncrona y Reactiva en JavaScript</a></li>

<li class="toctree-l1"><a class="reference internal" href="errores.html">Gestión de Errores</a></li>
<li class="toctree-l1"><a class="reference internal" href="webworkers.html">Web Workers</a></li>
<li class="toctree-l1"><a class="reference internal" href="vite.html">Vite</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-cd.html">Integración y Despliegue Continuo (CI/CD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="proyectos.html">Proyectos en Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentacion.html">Documentación en JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="proyectovanilla.html">Proyecto completo en Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebComponents.html">Web Components</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Angular</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="typescript.html">Typescript</a></li>
<li class="toctree-l1"><a class="reference internal" href="angular.html">Introducción a Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="httpangular.html">Comunicación con el servidor en Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="rutasangular.html">Rutas en Angular</a></li>
<li class="toctree-l1"><a class="reference internal" href="formulariosangular.html">Formularios en Angular</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/xxjcaxx/libro_dwec/tree/master" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/xxjcaxx/libro_dwec/tree/master/issues/new?title=Issue%20on%20page%20%2Fsupabase.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/supabase.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Supabase: (Backend como Servicio)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-tablas-y-api">Gestión de Tablas y API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select">Select</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#post">POST</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#patch">PATCH</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#almacenamiento-de-json">Almacenamiento de JSON</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autenticacion">Autenticación</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#activacion-de-rls-row-level-security">Activación de RLS (Row Level Security)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autenticacion-por-email-y-contrasena">Autenticación por Email y Contraseña</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-del-tiempo-de-sesion">Gestión del Tiempo de Sesión</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-perfiles-de-usuario">Gestión de Perfiles de Usuario</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-avatares">Gestión de Avatares</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#storage">Storage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subida-de-una-imagen-a-storage">Subida de una Imagen a Storage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descarga-de-una-imagen">Descarga de una Imagen</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#websocket">WebSocket</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ejemplo-de-comunicacion-broadcast">Ejemplo de Comunicación “Broadcast”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ejemplo-de-chat-con-mensajes-guardados">Ejemplo de Chat con Mensajes Guardados</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="supabase-backend-como-servicio">
<h1>Supabase: (Backend como Servicio)<a class="headerlink" href="#supabase-backend-como-servicio" title="Link to this heading">#</a></h1>
<p>Supabase es un Backend como Servicio (BaaS) que proporciona un conjunto de herramientas para desarrollar aplicaciones web sin la necesidad de implementar un backend completo. Este servicio incluye características como SDK, analíticas, autenticación, bases de datos, almacenamiento, dashboard, WebSockets, entre otros.</p>
<p>Supabase utiliza PostgreSQL como su motor de base de datos, permitiendo a los desarrolladores aprovechar todas las capacidades de esta robusta base de datos relacional.</p>
<p>Ofrece varios tipos de <code class="docutils literal notranslate"><span class="pre">APIs</span></code> y un <code class="docutils literal notranslate"><span class="pre">SDK</span></code> que facilita la interacción con el backend desde el cliente. También soporta el almacenamiento de archivos estáticos y permite la ejecución de funciones definidas por el usuario a través de RPC (Remote Procedure Call).</p>
<blockquote>
<div><p>Supabase será útil en este curso porque nos permite tener un Backend sin programarlo. Lo configuraremos mínimamente para usar su <code class="docutils literal notranslate"><span class="pre">API</span> <span class="pre">REST</span></code> y crear aplicaciones <code class="docutils literal notranslate"><span class="pre">SPA</span></code>. Puesto que hay que ser capaz de usar cualquier <code class="docutils literal notranslate"><span class="pre">API</span> <span class="pre">Rest</span></code>, no usaremos el SDK de Supabase inicialmente.</p>
</div></blockquote>
<section id="gestion-de-tablas-y-api">
<h2>Gestión de Tablas y API<a class="headerlink" href="#gestion-de-tablas-y-api" title="Link to this heading">#</a></h2>
<p>Cuando se crea una tabla en Supabase, se genera automáticamente una API para interactuar con ella. Puedes ver la API generada en el SDK o en Bash. Aquí utilizaremos ejemplos en Bash para evitar la instalación del SDK.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span><span class="s1">&#39;https://bqhnvwfovmcxfxr.supabase.co/rest/v1/graphs?select=id&#39;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;apikey: tu_apikey&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer tu_token&quot;</span>
</pre></div>
</div>
<p>Este comando <code class="docutils literal notranslate"><span class="pre">curl</span></code> realiza una petición GET a la tabla <code class="docutils literal notranslate"><span class="pre">graphs</span></code> para obtener el campo <code class="docutils literal notranslate"><span class="pre">id</span></code>.</p>
<p>En JavaScript, se puede hacer una solicitud similar usando <code class="docutils literal notranslate"><span class="pre">fetch</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="p">(()=&gt;{</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://bqhnvwfovmcxfxr.supabase.co/rest/v1/graphs&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;apiKey&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;tu_apikey&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Authorization&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Bearer tu_token&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})</span>
<span class="p">})();</span>
</pre></div>
</div>
</div>
</div>
<p>Al igual que el ‘verbo’ <code class="docutils literal notranslate"><span class="pre">GET</span></code> se pueden usar todos los demás de <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> para crear, actualizar, o borrar registros en la base de datos. Cómo usarlos está documentado en la <code class="docutils literal notranslate"><span class="pre">API</span> <span class="pre">Docs</span></code> autogenerada por Supabase para cada tabla. Algunas operaciones más complejas como filtros avanzados no las documentan automáticamente, pero se pueden consultar en la documentación genérica.</p>
<section id="select">
<h3>Select<a class="headerlink" href="#select" title="Link to this heading">#</a></h3>
<p>Si no queremos todas las columnas o queremos los datos con otro formato, podemos pedir que realice un <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, al fin y al cabo es una base de datos relacional. La sintaxis se puede ver en estos ejemplos:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//bqhnvwfovmcxfxr.supabase.co/rest/v1/profiles?select=username,telefono,avatar_url,empresa:empresas(*),id</span>
</pre></div>
</div>
<p>En este ejemplo obtenemos algunos datos típicos de un <code class="docutils literal notranslate"><span class="pre">profile</span></code> y todos los datos de la empresa, la cual está relacionada con una clave que Supabase conoce. Esto producirá una subconsulta y no solo retornará el <code class="docutils literal notranslate"><span class="pre">id</span></code>, que es lo que hay en la columna <code class="docutils literal notranslate"><span class="pre">empresa</span></code>, si no también otros datos.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//bqhnvwfovmcxfxr.supabase.co/rest/v1/empresas?select=nombre,dirección,telefono,c_postal,localidad,cif,email,web,presidente,coordinadores:coordinacion_empresa(profiles(id,username)),socios:empresas_socios(socios(id,nombre)),id</span>
</pre></div>
</div>
<p>En este ejemplo hay un <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> complejo en el que se piden datos que están en la tabla, pero luego hay una subconsulta en la que se piden los coordinadores de esa empresa, que están en una tabla intermedia <code class="docutils literal notranslate"><span class="pre">coordinacion_empresa</span></code>. Como Supabase conoce las claves ajenas, retorna los <code class="docutils literal notranslate"><span class="pre">profiles</span></code> que están en esa relación muchos a muchos. Además, de estos extrae el <code class="docutils literal notranslate"><span class="pre">id</span></code>y el <code class="docutils literal notranslate"><span class="pre">username</span></code>. Lo mismo para con los <code class="docutils literal notranslate"><span class="pre">socios</span></code>, la tabla intermedia <code class="docutils literal notranslate"><span class="pre">empresas_socios</span></code> y la tabla <code class="docutils literal notranslate"><span class="pre">socios</span></code>, de la que queremos el id y el nombre.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//bqhnvwfovmcxfxr.supabase.co/rest/v1/profiles?select=*&amp;id=eq.8662025a-25be-4777-ae54-66cb6111129e</span>
</pre></div>
</div>
<p>En este ejemplo ponemos una condición simple de búsqueda, lo que será el <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> en la consulta. En ella pedimos que el <code class="docutils literal notranslate"><span class="pre">id</span></code> cumpla la condición de ser igual (<code class="docutils literal notranslate"><span class="pre">eq</span></code>) que un <code class="docutils literal notranslate"><span class="pre">uuid</span></code> determinado separado por un punto.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">https</span><span class="o">:</span><span class="c1">//bqhnvwfovmcxfxr.supabase.co/rest/v1/teams?select=*,players(*,goals(*))&amp;team_id=eq.50124</span>
</pre></div>
</div>
<p>En el ejemplo anterior obtenemos el equipo con una condición y aprovechamos que <code class="docutils literal notranslate"><span class="pre">players</span></code> tiene una clave ajena a <code class="docutils literal notranslate"><span class="pre">teams</span></code>, al igual que <code class="docutils literal notranslate"><span class="pre">goals</span></code> con <code class="docutils literal notranslate"><span class="pre">players</span></code> para conseguir todos los datos de los <code class="docutils literal notranslate"><span class="pre">players</span></code> y <code class="docutils literal notranslate"><span class="pre">goals</span></code> de ese equipo. Esta consulta funciona siempre que las relaciones están bien establecidas en las tablas.</p>
<p>Se pueden poner condiciones más complejas. En ese caso es mejor consultar la documentación, pero aquí tenemos algún ejemplo:</p>
<ul class="simple">
<li><p><strong>Pedir la cantidad (count)</strong>:  Método <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> y <code class="docutils literal notranslate"><span class="pre">prefer:</span> <span class="pre">count=exact</span></code> en el header. El resultado se recibe en el header <code class="docutils literal notranslate"><span class="pre">content-range</span></code>.</p></li>
<li><p><strong>Consultas con “like”</strong>: <code class="docutils literal notranslate"><span class="pre">products?select=*&amp;identifier=like.%AX%</span></code></p></li>
<li><p><strong>Consultas con OR lógico</strong>:  <code class="docutils literal notranslate"><span class="pre">select=*&amp;or=(id.eq.464,</span> <span class="pre">id.eq.466)</span></code></p></li>
</ul>
<blockquote>
<div><p>En cualquier caso, si queremos saber cómo se traduce una petición en la API REST, podemos usar esta herramienta: <a class="reference external" href="https://supabase.com/docs/guides/api/sql-to-rest">https://supabase.com/docs/guides/api/sql-to-rest</a></p>
</div></blockquote>
</section>
<section id="post">
<h3>POST<a class="headerlink" href="#post" title="Link to this heading">#</a></h3>
<p>Sirve para crear nuevos registros en una tabla. En la URL se pone la tabla, el verbo <code class="docutils literal notranslate"><span class="pre">POST</span></code> y en el <code class="docutils literal notranslate"><span class="pre">BODY</span></code> se ponen los datos en formato <code class="docutils literal notranslate"><span class="pre">JSON</span></code>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://bqhnvwfovmcxfxr.supabase.co/rest/v1/movies`</span><span class="p">,{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="sb">`POST`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;apiKey&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">SUPABASE_KEY</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="s2">&quot;Authorization&quot;</span><span class="w"> </span><span class="o">:</span><span class="s2">&quot;Bearer &quot;</span><span class="o">+</span><span class="nx">token</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;Prefer&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;return=representation&quot;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
</section>
<section id="patch">
<h3>PATCH<a class="headerlink" href="#patch" title="Link to this heading">#</a></h3>
<p>Funciona igual que el <code class="docutils literal notranslate"><span class="pre">POST</span></code>,pero hay que indicar en la URL el <code class="docutils literal notranslate"><span class="pre">id</span></code> o otro campo de filtro para modificar los que cumplan esa condición:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://bqhnvwfovmcxfxr.supabase.co/rest/v1/movies?id=eq.</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="sb">`PATCH`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;apiKey&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">SUPABASE_KEY</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="s2">&quot;Authorization&quot;</span><span class="w"> </span><span class="o">:</span><span class="s2">&quot;Bearer &quot;</span><span class="o">+</span><span class="nx">token</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;Prefer&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;return=representation&quot;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>Además, tenemos <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> con la sintaxis de <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> para eliminar.</p>
</section>
<section id="almacenamiento-de-json">
<h3>Almacenamiento de JSON<a class="headerlink" href="#almacenamiento-de-json" title="Link to this heading">#</a></h3>
<p>En Supabase, el primer nivel de los objetos se guarda como columnas en la tabla. Si los objetos tienen subniveles o se realizan consultas a otras tablas, se guardan en formato JSON como texto.</p>
<p><a class="reference external" href="https://supabase.com/docs/guides/database/json">https://supabase.com/docs/guides/database/json</a></p>
</section>
</section>
<section id="autenticacion">
<h2>Autenticación<a class="headerlink" href="#autenticacion" title="Link to this heading">#</a></h2>
<p>Las tablas públicas son accesibles con la apiKey pública. Sin embargo, al estar en el cliente, cualquiera podría ver esta apiKey en el código. Para proteger tablas privadas, se deben crear usuarios y aplicar métodos de autenticación y autorización.</p>
<p>En resumen, para implementar la autenticación en Supabase hay que seguir unos pasos:</p>
<ol class="arabic simple">
<li><p>Habilitar o asegurarse de que está habilitada la autenticación por contraseña.</p></li>
<li><p>Ir a la parte de <code class="docutils literal notranslate"><span class="pre">SQL</span> <span class="pre">Editor</span></code> y ejecutar el <code class="docutils literal notranslate"><span class="pre">Quickstart</span></code> <code class="docutils literal notranslate"><span class="pre">User</span> <span class="pre">Management</span> <span class="pre">Starter</span></code>. Esto no es preciso para la autenticación, pero prepara la base de datos para mantener los perfiles de los usuarios y sus avatares. Si lo hacemos desde el principio, todos los usuarios funcionarán correctamente.</p></li>
<li><p>Ir al <code class="docutils literal notranslate"><span class="pre">API</span> <span class="pre">Docs</span></code> y mirar cómo se hace la autenticación por <code class="docutils literal notranslate"><span class="pre">Bash</span></code>.</p></li>
<li><p>Crear funciones para autenticar y registrar usuarios con el método descrito en el paso anterior.</p></li>
<li><p>Crear formularios para llamar a esas funciones.</p></li>
<li><p>Guardar el <code class="docutils literal notranslate"><span class="pre">token</span></code> después de la autenticación en <code class="docutils literal notranslate"><span class="pre">Localstorage</span></code>.</p></li>
<li><p>Modificar las funciones ya creadas para usar el <code class="docutils literal notranslate"><span class="pre">token</span></code>en cada petición.</p></li>
<li><p>Modificar las <code class="docutils literal notranslate"><span class="pre">RLS</span></code> de las tablas para protegerlas de las peticiones que no tengan el token.</p></li>
<li><p>Aplicar funciones para gestionar la duración de las sesiones, el logout…</p></li>
<li><p>Gestionar los perfiles de usuario como una tabla más llamada <code class="docutils literal notranslate"><span class="pre">profiles</span></code> y un bucket <code class="docutils literal notranslate"><span class="pre">avatars</span></code> creados automáticamente con el <code class="docutils literal notranslate"><span class="pre">User</span> <span class="pre">Management</span> <span class="pre">Starter</span></code>.</p></li>
</ol>
<section id="activacion-de-rls-row-level-security">
<h3>Activación de RLS (Row Level Security)<a class="headerlink" href="#activacion-de-rls-row-level-security" title="Link to this heading">#</a></h3>
<p>Primero, es necesario activar RLS en las tablas y crear políticas para controlar el acceso. Por ejemplo, podemos permitir que solo los usuarios autenticados puedan leer y escribir en una tabla.</p>
<blockquote>
<div><p>Las <code class="docutils literal notranslate"><span class="pre">RLS</span></code> son muy interesantes y, por si solas casi permiten configurar el comportamiento de un backend completo. No obstante, por cuestión de tiempo y enfoque,  para el curso las haremos simples y permisivas para todos los usuarios con la única condición de que estén autenticados.</p>
</div></blockquote>
</section>
<section id="autenticacion-por-email-y-contrasena">
<h3>Autenticación por Email y Contraseña<a class="headerlink" href="#autenticacion-por-email-y-contrasena" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://www.youtube.com/watch?v=pi33WDrgfpI">https://www.youtube.com/watch?v=pi33WDrgfpI</a></p>
<p>Podemos invitar usuarios a través de la interfaz o crear un formulario de inscripción. En cualquier caso, es necesario que el usuario confirme su email.</p>
<p>En el caso de la invitación, la redirección por defecto es a <code class="docutils literal notranslate"><span class="pre">localhost:3000</span></code>, pero esto se puede modificar. Una vez confirmado, el usuario recibirá un token que se puede probar en <a class="reference external" href="https://jwt.io">jwt.io</a>. Este token se usará en la cabecera <code class="docutils literal notranslate"><span class="pre">Authorization:</span> <span class="pre">Bearer</span></code>.</p>
<p>El token lo podemos guardar en <code class="docutils literal notranslate"><span class="pre">localstorage</span></code>para recuperar cada vez que se haga una petición.</p>
<section id="gestion-del-tiempo-de-sesion">
<h4>Gestión del Tiempo de Sesión<a class="headerlink" href="#gestion-del-tiempo-de-sesion" title="Link to this heading">#</a></h4>
<p>Después de iniciar sesión, guardamos el token en <code class="docutils literal notranslate"><span class="pre">LocalStorage</span></code> para realizar peticiones. Cada inicio de sesión retorna un tiempo de expiración (<code class="docutils literal notranslate"><span class="pre">expires_in</span></code> y <code class="docutils literal notranslate"><span class="pre">expires_at</span></code>). Podemos calcular la fecha de expiración y evitar confiar en el token después de esta fecha.</p>
</section>
</section>
<section id="gestion-de-perfiles-de-usuario">
<h3>Gestión de Perfiles de Usuario<a class="headerlink" href="#gestion-de-perfiles-de-usuario" title="Link to this heading">#</a></h3>
<p>Es común que los usuarios necesiten gestionar información personal como avatar, dirección, teléfono, etc. Para ello, Supabase proporciona un script SQL (<code class="docutils literal notranslate"><span class="pre">Quickstart</span></code> <code class="docutils literal notranslate"><span class="pre">User</span> <span class="pre">Management</span> <span class="pre">Starter</span></code>) que crea una tabla de perfiles de usuario y asocia la información correspondiente. Este script crea unos <code class="docutils literal notranslate"><span class="pre">triggers</span></code> en la base de datos para crear una fila en <code class="docutils literal notranslate"><span class="pre">profiles</span></code> cada vez que un usuario se registra.</p>
<p>Cuando un usuario inicia sesión, obtenemos sus datos de perfil y los almacenamos en <code class="docutils literal notranslate"><span class="pre">LocalStorage</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getProfile</span><span class="p">(){</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;uid&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">responseGet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getData</span><span class="p">(</span><span class="sb">`profiles?id=eq.</span><span class="si">${</span><span class="nx">uid</span><span class="si">}</span><span class="sb">&amp;select=*`</span><span class="p">,</span><span class="nx">access_token</span><span class="p">);</span><span class="w">  </span><span class="c1">// Función que simplifica el fetch</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">avatar_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">responseGet</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">avatar_url</span><span class="p">;</span>
<span class="w">    </span><span class="nx">responseGet</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">avatar_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">avatar_url</span><span class="p">){</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">imageBlob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getFileRequest</span><span class="p">(</span><span class="nx">avatar_url</span><span class="p">,</span><span class="nx">access_token</span><span class="p">);</span><span class="w"> </span><span class="c1">// Función que simplifica el fetch a un bucket. </span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">imageBlob</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nx">imageBlob</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">Blob</span><span class="p">){</span>
<span class="w">            </span><span class="nx">responseGet</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">avatar_blob</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="w"> </span><span class="nx">imageBlob</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">responseGet</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Esta función, además, pide el fichero del avatar.</p>
<section id="gestion-de-avatares">
<h4>Gestión de Avatares<a class="headerlink" href="#gestion-de-avatares" title="Link to this heading">#</a></h4>
<p>Los avatares se guardan en “Storage”. Es necesario crear un bucket con permisos de escritura y actualización para los usuarios autenticados. Para subir imágenes, se realiza un POST con un <code class="docutils literal notranslate"><span class="pre">FormData</span></code> que contiene la imagen.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">updateProfile</span><span class="p">(</span><span class="nx">profile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;uid&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">formImg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">();</span>
<span class="w">    </span><span class="nx">formImg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;avatar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">profile</span><span class="p">.</span><span class="nx">avatar</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;avatarProfile.png&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">avatarResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fileRequest</span><span class="p">(</span><span class="sb">`/storage/v1/object/avatars/avatar</span><span class="si">${</span><span class="nx">uid</span><span class="si">}</span><span class="sb">.png`</span><span class="p">,</span><span class="w"> </span><span class="nx">formImg</span><span class="p">,</span><span class="w"> </span><span class="nx">access_token</span><span class="p">);</span>
<span class="w">    </span><span class="nx">profile</span><span class="p">.</span><span class="nx">avatar_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">avatarResponse</span><span class="p">.</span><span class="nx">urlAvatar</span><span class="p">;</span>
<span class="w">    </span><span class="ow">delete</span><span class="w"> </span><span class="nx">profile</span><span class="p">.</span><span class="nx">avatar</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">responseUpdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">updateData</span><span class="p">(</span><span class="sb">`profiles?id=eq.</span><span class="si">${</span><span class="nx">uid</span><span class="si">}</span><span class="sb">&amp;select=*`</span><span class="p">,</span><span class="w"> </span><span class="nx">access_token</span><span class="p">,</span><span class="w"> </span><span class="nx">profile</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En el ejemplo anterior se supone que hay una función que sube la imagen. Lo que nos interesa es que la subida genera una url que será la que se guarde en la columna de avatar, en vez de la imagen.</p>
</section>
</section>
</section>
<section id="storage">
<h2>Storage<a class="headerlink" href="#storage" title="Link to this heading">#</a></h2>
<section id="subida-de-una-imagen-a-storage">
<h3>Subida de una Imagen a Storage<a class="headerlink" href="#subida-de-una-imagen-a-storage" title="Link to this heading">#</a></h3>
<p>Aquí hay un ejemplo de cómo podemos subir una imagen a storage. Veamos que añadimos <code class="docutils literal notranslate"><span class="pre">&quot;x-upsert&quot;:</span> <span class="pre">true</span></code> para permitir reescribir. Luego añadimos la imagen a un <code class="docutils literal notranslate"><span class="pre">formData</span></code>, ya que supabase la necesita como de un formulario. Finalmente se sube a la url correpondiente con el bucket y el nombre.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">headersFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;apiKey&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">SUPABASE_KEY</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Authorization&quot;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;x-upsert&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">formData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">();</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">imageBlob</span><span class="p">,</span><span class="w"> </span><span class="nx">fileName</span><span class="p">);</span>
<span class="w">          </span>
<span class="kd">let</span><span class="w"> </span><span class="nx">responseSupa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://</span><span class="si">${</span><span class="nx">urlProject</span><span class="si">}</span><span class="sb">.supabase.co/storage/v1/object/</span><span class="si">${</span><span class="nx">bucket</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">fileName</span><span class="si">}</span><span class="sb">.png`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="nx">headersFile</span><span class="p">,</span>
<span class="w">                </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nx">formData</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
</section>
<section id="descarga-de-una-imagen">
<h3>Descarga de una Imagen<a class="headerlink" href="#descarga-de-una-imagen" title="Link to this heading">#</a></h3>
<p>Si no se necesita autorización, se puede utilizar un bucket público y la URL proporcionada. Si se requiere autorización, se debe enviar la API key y el token.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">headersFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;apiKey&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">SUPABASE_KEY</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Authorization&quot;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span>
<span class="p">};</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="nx">headersFile</span>
<span class="p">});</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">300</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">datos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">blob</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">datos</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
<span class="p">}</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">avatar_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">responseGet</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">avatar_url</span><span class="p">;</span>
<span class="nx">responseGet</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">avatar_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">getFileRequest</span><span class="p">(</span><span class="nx">avatar_url</span><span class="p">,</span><span class="w"> </span><span class="nx">access_token</span><span class="p">));</span>
</pre></div>
</div>
</section>
</section>
<section id="websocket">
<h2>WebSocket<a class="headerlink" href="#websocket" title="Link to this heading">#</a></h2>
<p>Supabase ofrece una función llamada Realtime para manejar WebSockets. Es una buena manera de practicar con un servidor capaz de manejarlos. Permite varias formas como <code class="docutils literal notranslate"><span class="pre">Broadcast</span></code> para enviar mensajes entre clientes, <code class="docutils literal notranslate"><span class="pre">Presence</span></code> para sincronizar estados entre clientes o <code class="docutils literal notranslate"><span class="pre">Postgres</span> <span class="pre">Changes</span></code> para escuchar cambios en tablas de la base de datos. Si quisiéramos hacer un juego, por ejemplo, podemos usar las dos primeras opciones, y para tener <code class="docutils literal notranslate"><span class="pre">websocket</span></code> pero con persistencia usaríamos la tercera opción.</p>
<p>Para reaccionar a los cambios en la base de datos o publicar datos en tiempo real se debe agregar en la sección de <code class="docutils literal notranslate"><span class="pre">Database</span> <span class="pre">&gt;</span> <span class="pre">Publications</span></code> las tablas que queremos monitorear. Es muy recomendable utilizar las librerías proporcionadas por Supabase para esto.</p>
<p><a class="reference external" href="https://supabase.com/docs/guides/realtime/postgres-changes">https://supabase.com/docs/guides/realtime/postgres-changes</a></p>
<section id="ejemplo-de-comunicacion-broadcast">
<h3>Ejemplo de Comunicación “Broadcast”<a class="headerlink" href="#ejemplo-de-comunicacion-broadcast" title="Link to this heading">#</a></h3>
<p>En este ejemplo se puede observar cómo Supabase permite la notificación de cambios en las tablas mediante WebSockets.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">supabaseRealTimeClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">supabase</span><span class="p">.</span><span class="nx">createClient</span><span class="p">(</span><span class="nx">supabaseUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">SUPABASE_KEY</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">supabaseRealTimeClient</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;chat-db&#39;</span><span class="p">)</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">renderMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">messageContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-container&#39;</span><span class="p">);</span>
<span class="w">   </span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">messageElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">messageElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">messageElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">currentUser</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;outgoing&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;incoming&#39;</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">messageContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">messageContent</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;message-content&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">messageContent</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>

<span class="w">  </span><span class="nx">messageElement</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">messageContent</span><span class="p">);</span>
<span class="w">  </span><span class="nx">messageContainer</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">messageElement</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Hacer scroll hacia abajo para mostrar el último mensaje</span>
<span class="w">  </span><span class="nx">messageContainer</span><span class="p">.</span><span class="nx">scrollTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">messageContainer</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">channel</span>
<span class="w">  </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;postgres_changes&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">schema</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;public&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;chat&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
<span class="w">    </span><span class="nx">renderMessage</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="ow">new</span><span class="p">)</span>
<span class="w">  </span><span class="p">}).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">status</span><span class="p">))</span>



<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">downloadHistoric</span><span class="p">(){</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">supabaseRealTimeClient</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">).</span><span class="nx">select</span><span class="p">();</span>
<span class="w">   </span><span class="c1">// console.log(data);</span>
<span class="w">   </span><span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">renderMessage</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,()=&gt;{</span>

<span class="w">    </span><span class="nx">downloadHistoric</span><span class="p">();</span>


<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#send-button&quot;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()=&gt;{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#message-input&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">supabaseRealTimeClient</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">).</span><span class="nx">insert</span><span class="p">([</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">      </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="nx">currentUser</span><span class="p">,</span>
<span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="nx">message</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">  </span><span class="p">]);</span>
<span class="w">   </span><span class="p">});</span><span class="w"> </span>
<span class="w">  </span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="ejemplo-de-chat-con-mensajes-guardados">
<h3>Ejemplo de Chat con Mensajes Guardados<a class="headerlink" href="#ejemplo-de-chat-con-mensajes-guardados" title="Link to this heading">#</a></h3>
<p>Supabase facilita la implementación de un sistema de chat donde los mensajes se guardan en la base de datos. Puedes modificar el chat para mantener la sesión del usuario en cookies.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">supabaseRealTimeClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">supabase</span><span class="p">.</span><span class="nx">createClient</span><span class="p">(</span><span class="nx">supabaseUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">SUPABASE_KEY</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">supabaseRealTimeClient</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">broadcast</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">self</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>



<span class="nx">channel</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">()</span>
<span class="w">  </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;broadcast&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;supa&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">messageContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-container&#39;</span><span class="p">);</span>
<span class="w">   </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">messageElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">messageElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">messageElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">currentUser</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;outgoing&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;incoming&#39;</span><span class="p">);</span>
<span class="w">  </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">messageContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">messageContent</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;message-content&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">messageContent</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">payload</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
<span class="w">  </span>
<span class="w">    </span><span class="nx">messageElement</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">messageContent</span><span class="p">);</span>
<span class="w">    </span><span class="nx">messageContainer</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">messageElement</span><span class="p">);</span>
<span class="w">  </span>
<span class="w">    </span><span class="c1">// Hacer scroll hacia abajo para mostrar el último mensaje</span>
<span class="w">    </span><span class="nx">messageContainer</span><span class="p">.</span><span class="nx">scrollTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">messageContainer</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="w">  </span><span class="p">})</span>



<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,()=&gt;{</span>
<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#send-button&quot;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,()=&gt;{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#message-input&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;broadcast&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;supa&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">message</span><span class="p">,</span><span class="nx">user</span><span class="o">:</span><span class="nx">currentUser</span><span class="p">},</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">   </span><span class="p">});</span><span class="w"> </span>
<span class="w">  </span><span class="p">})</span>
</pre></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "deno"
        },
        kernelOptions: {
            name: "deno",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'deno'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ajax.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Comunicación con el servidor</p>
      </div>
    </a>
    <a class="right-next"
       href="npm.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">NPM</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-tablas-y-api">Gestión de Tablas y API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select">Select</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#post">POST</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#patch">PATCH</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#almacenamiento-de-json">Almacenamiento de JSON</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autenticacion">Autenticación</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#activacion-de-rls-row-level-security">Activación de RLS (Row Level Security)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autenticacion-por-email-y-contrasena">Autenticación por Email y Contraseña</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-del-tiempo-de-sesion">Gestión del Tiempo de Sesión</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-perfiles-de-usuario">Gestión de Perfiles de Usuario</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-avatares">Gestión de Avatares</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#storage">Storage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subida-de-una-imagen-a-storage">Subida de una Imagen a Storage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descarga-de-una-imagen">Descarga de una Imagen</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#websocket">WebSocket</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ejemplo-de-comunicacion-broadcast">Ejemplo de Comunicación “Broadcast”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ejemplo-de-chat-con-mensajes-guardados">Ejemplo de Chat con Mensajes Guardados</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jose Castillo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>